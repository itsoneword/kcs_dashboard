import{c as ut,a as $,f as D}from"../chunks/z1_h_S-m.js";import{i as xt}from"../chunks/CKvl8f00.js";import{p as gt,o as _t,f as bt,a as ft,$ as ht,s as g,m as N,g as e,c as t,b as i,r as a,n as c,t as ie,e as Ne,d as yt}from"../chunks/DO95TrpH.js";import{h as kt,r as wt,s as _,e as v}from"../chunks/DePN81sB.js";import{i as ne}from"../chunks/i89i58Dp.js";import{e as Ct}from"../chunks/KzdxLMOR.js";import{r as h,a as Pe,b as k}from"../chunks/B0rVqcg2.js";import{s as It}from"../chunks/DPUg7jpB.js";import{s as $t,a as At}from"../chunks/DXMp_b0k.js";import{p as St}from"../chunks/CLGsUtju.js";import{g as P}from"../chunks/BvPgAsJ_.js";import{a as Ke,b as oe}from"../chunks/VlzhU-cE.js";var Dt=D('<div class="flex items-center justify-center min-h-screen"><div class="text-center"><div class="animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600 mx-auto"></div> <p class="mt-4 text-gray-600">Loading evaluation...</p></div></div>'),Lt=D("<span> </span>"),Mt=D('<div class="card p-6"><div class="flex justify-between items-center mb-4"><h3 class="text-lg font-medium text-gray-900"> </h3> <div class="text-sm text-gray-500"> </div></div> <div class="grid grid-cols-1 lg:grid-cols-2 gap-6"><div class="space-y-4"><div><label class="block text-sm font-medium text-gray-700 mb-1">Case ID</label> <input type="text" placeholder="Enter case ID from CRM" class="input"/></div> <div><label class="flex items-center space-x-2"><input type="checkbox" class="checkbox"/> <span class="text-sm font-medium text-gray-700">KB Potential</span></label> <p class="text-xs text-gray-500 mt-1">Should this case have an article?</p></div> <div><label class="flex items-center space-x-2"><input type="checkbox" class="checkbox"/> <span class="text-sm font-medium text-gray-700">Article Linked</span></label> <p class="text-xs text-gray-500 mt-1">Was an article linked/used?</p></div> <div><label class="flex items-center space-x-2"><input type="checkbox" class="checkbox"/> <span class="text-sm font-medium text-gray-700">Relevant Link</span></label> <p class="text-xs text-gray-500 mt-1">Was the linked article correct/relevant?</p></div></div> <div class="space-y-4"><div><label class="flex items-center space-x-2"><input type="checkbox" class="checkbox"/> <span class="text-sm font-medium text-gray-700">Improvement Opportunity</span></label> <p class="text-xs text-gray-500 mt-1">Could an existing article be improved?</p></div> <div><label class="flex items-center space-x-2"><input type="checkbox" class="checkbox"/> <span class="text-sm font-medium text-gray-700">Article Improved</span></label> <p class="text-xs text-gray-500 mt-1">Was an article actually improved?</p></div> <div><label class="flex items-center space-x-2"><input type="checkbox" class="checkbox"/> <span class="text-sm font-medium text-gray-700">Create Opportunity</span></label> <p class="text-xs text-gray-500 mt-1">Should a new article be created?</p></div> <div><label class="flex items-center space-x-2"><input type="checkbox" class="checkbox"/> <span class="text-sm font-medium text-gray-700">Article Created</span></label> <p class="text-xs text-gray-500 mt-1">Was a new article actually created?</p></div></div></div> <div class="mt-4"><label class="block text-sm font-medium text-gray-700 mb-1">Notes</label> <textarea placeholder="Add any additional notes about this case..." rows="3" class="input"></textarea></div></div>'),Ot=D('<div class="min-h-screen bg-gray-50"><nav class="bg-white shadow-sm border-b border-gray-200"><div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"><div class="flex justify-between items-center h-16"><div class="flex items-center space-x-4"><a href="/coach" class="text-gray-600 hover:text-gray-900"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg></a> <h1 class="text-xl font-semibold text-gray-900">Evaluation Details</h1></div> <div class="flex items-center space-x-4"><!> <span class="text-sm text-gray-700"> </span> <span class="badge badge-coach">Coach</span> <button class="btn-secondary text-sm">Logout</button></div></div></div></nav> <div class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8"><div class="px-4 py-6 sm:px-0"><div class="card p-6 mb-6"><div class="flex justify-between items-start"><div><h2 class="text-2xl font-bold text-gray-900"> </h2> <p class="text-gray-600"> </p> <p class="text-sm text-gray-500 mt-1"> </p></div> <div class="text-right"><div class="text-sm text-gray-500"> </div> <div class="text-sm text-gray-500"> </div></div></div></div> <div class="card p-6 mb-6 bg-blue-50 border-blue-200"><h3 class="text-lg font-medium text-blue-900 mb-3">KCS Evaluation Criteria</h3> <div class="text-sm text-blue-800 space-y-2"><p><strong>KB Potential:</strong> Whether case should have an article or not. If false, other fields are not required.</p> <p><strong>Article Linked:</strong> If an article is linked/used. Used for calculating link rate.</p> <p><strong>Relevant Link:</strong> If the linked article is correct. Used for link accuracy rate.</p> <p><strong>Improvement Opportunity:</strong> Activates Article Improved field.</p> <p><strong>Article Improved:</strong> Used for calculating contribution index. Only active if Improvement Opportunity is true.</p> <p><strong>Create Opportunity:</strong> Activates Article Created field.</p> <p><strong>Article Created:</strong> Used for calculating contribution index. Only active if Create Opportunity is true.</p></div></div> <div class="space-y-6"><!> <div class="text-center"><button class="btn-secondary"><svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg> Add New Case</button></div></div></div></div></div>'),jt=D(`<div class="flex items-center justify-center min-h-screen"><div class="text-center"><h2 class="text-xl font-semibold text-gray-900">Evaluation not found</h2> <p class="text-gray-600 mt-2">The evaluation you're looking for doesn't exist or you don't have permission to view it.</p> <a href="/coach" class="btn-primary mt-4">Back to Evaluations</a></div></div>`);function Ht(Ue,Fe){gt(Fe,!1);const[Re,qe]=$t(),Qe=()=>At(St,"$page",Re);let L=N(null),l=N(null),K=N(!0),le=!1,m=N(""),U,A=new Map,F=null;_t(()=>(U=parseInt(Qe().params.id),Ke.subscribe(n=>{var p,d;!n.isAuthenticated&&!n.isLoading?P("/login"):n.isAuthenticated&&(g(L,n.user),!((p=e(L))!=null&&p.is_coach)&&!((d=e(L))!=null&&d.is_admin)?P("/dashboard"):ce())})));async function ce(){try{g(K,!0);const s=await oe.getEvaluationById(U);g(l,s.evaluation)}catch(s){console.error("Error loading evaluation:",s),alert("Failed to load evaluation"),P("/coach")}finally{g(K,!1)}}function u(s,n,p){var f;if(!e(l))return;const d=(f=e(l).cases)==null?void 0:f.findIndex(S=>S.id===s.id);d!==void 0&&d>=0&&e(l).cases&&yt(l,e(l).cases[d]={...e(l).cases[d],[n]:p});const b=A.get(s.id)||{};A.set(s.id,{...b,[n]:p}),F&&clearTimeout(F),F=setTimeout(()=>{ze()},1e3)}async function ze(){if(A.size!==0)try{le=!0,g(m,"Saving...");const s=Array.from(A.entries()).map(([n,p])=>oe.updateCaseEvaluation(n,p));await Promise.all(s),A.clear(),g(m,"Saved"),setTimeout(()=>{g(m,"")},2e3)}catch(s){console.error("Error saving changes:",s),g(m,"Error saving"),setTimeout(()=>{g(m,"")},3e3)}finally{le=!1}}async function He(){var s;if((s=e(l))!=null&&s.cases)try{const n=Math.max(...e(l).cases.map(d=>d.case_number))+1,p=await oe.addCaseToEvaluation(U,{case_number:n});await ce()}catch(n){console.error("Error adding new case:",n),alert("Failed to add new case")}}function de(s){return new Date(s).toLocaleDateString()}function Ge(s){const n=new Date(s).getMonth()+1;return`Q${Math.ceil(n/3)}`}function w(s,n){switch(n){case"article_linked":case"improvement_opportunity":case"create_opportunity":return!s.kb_potential;case"relevant_link":return!s.kb_potential||!s.article_linked;case"article_improved":return!s.kb_potential||!s.improvement_opportunity;case"article_created":return!s.kb_potential||!s.create_opportunity;default:return!1}}async function Je(){await Ke.logout(),P("/login")}xt();var ve=ut();kt(s=>{ht.title="Evaluation Details - KCS Portal"});var Ve=bt(ve);{var Xe=s=>{var n=Dt();$(s,n)},Ye=(s,n)=>{{var p=b=>{var f=Ot(),S=t(f),pe=t(S),me=t(pe),ue=i(t(me),2),xe=t(ue);{var Ze=x=>{var r=Lt(),y=t(r,!0);a(r),ie(()=>{It(r,1,`text-sm ${e(m)==="Saved"?"text-green-600":e(m)==="Saving..."?"text-blue-600":"text-red-600"}`),_(y,e(m))}),$(x,r)};ne(xe,x=>{e(m)&&x(Ze)})}var R=i(xe,2),Ee=t(R);a(R);var et=i(R,4);a(ue),a(me),a(pe),a(S);var ge=i(S,2),_e=t(ge),q=t(_e),be=t(q),Q=t(be),z=t(Q),tt=t(z,!0);a(z);var H=i(z,2),at=t(H);a(H);var fe=i(H,2),st=t(fe);a(fe),a(Q);var he=i(Q,2),G=t(he),rt=t(G);a(G);var ye=i(G,2),it=t(ye);a(ye),a(he),a(be),a(q);var ke=i(q,4),we=t(ke);Ct(we,1,()=>e(l).cases||[],x=>x.id,(x,r)=>{var y=Mt(),C=t(y),I=t(C),ot=t(I);a(I);var Ie=i(I,2),lt=t(Ie);a(Ie),a(C);var J=i(C,2),V=t(J),X=t(V),Y=i(t(X),2);h(Y),a(X);var Z=i(X,2),$e=t(Z),E=t($e);h(E),c(2),a($e),c(2),a(Z);var ee=i(Z,2),Ae=t(ee),M=t(Ae);h(M),c(2),a(Ae),c(2),a(ee);var Se=i(ee,2),De=t(Se),O=t(De);h(O),c(2),a(De),c(2),a(Se),a(V);var Le=i(V,2),te=t(Le),Me=t(te),j=t(Me);h(j),c(2),a(Me),c(2),a(te);var ae=i(te,2),Oe=t(ae),T=t(Oe);h(T),c(2),a(Oe),c(2),a(ae);var se=i(ae,2),je=t(se),B=t(je);h(B),c(2),a(je),c(2),a(se);var Te=i(se,2),Be=t(Te),W=t(Be);h(W),c(2),a(Be),c(2),a(Te),a(Le),a(J);var We=i(J,2),re=i(t(We),2);wt(re),a(We),a(y),ie((o,ct,dt,vt,pt,mt)=>{_(ot,`Case #${e(r).case_number??""}`),_(lt,`Case ID: ${e(r).case_id||"Not specified"}`),Pe(Y,e(r).case_id||""),k(E,e(r).kb_potential),k(M,e(r).article_linked),M.disabled=o,k(O,e(r).relevant_link),O.disabled=ct,k(j,e(r).improvement_opportunity),j.disabled=dt,k(T,e(r).article_improved),T.disabled=vt,k(B,e(r).create_opportunity),B.disabled=pt,k(W,e(r).article_created),W.disabled=mt,Pe(re,e(r).notes||"")},[()=>w(e(r),"article_linked"),()=>w(e(r),"relevant_link"),()=>w(e(r),"improvement_opportunity"),()=>w(e(r),"article_improved"),()=>w(e(r),"create_opportunity"),()=>w(e(r),"article_created")],Ne),v("input",Y,o=>u(e(r),"case_id",o.target.value)),v("change",E,o=>u(e(r),"kb_potential",o.target.checked)),v("change",M,o=>u(e(r),"article_linked",o.target.checked)),v("change",O,o=>u(e(r),"relevant_link",o.target.checked)),v("change",j,o=>u(e(r),"improvement_opportunity",o.target.checked)),v("change",T,o=>u(e(r),"article_improved",o.target.checked)),v("change",B,o=>u(e(r),"create_opportunity",o.target.checked)),v("change",W,o=>u(e(r),"article_created",o.target.checked)),v("input",re,o=>u(e(r),"notes",o.target.value)),$(x,y)});var Ce=i(we,2),nt=t(Ce);a(Ce),a(ke),a(_e),a(ge),a(f),ie((x,r,y)=>{var C,I;_(Ee,`Welcome, ${((C=e(L))==null?void 0:C.name)??""}`),_(tt,e(l).engineer_name),_(at,`Evaluation for ${x??""} (${r??""})`),_(st,`Coach: ${e(l).coach_name??""}`),_(rt,`Created: ${y??""}`),_(it,`Cases: ${(((I=e(l).cases)==null?void 0:I.length)||0)??""}`)},[()=>de(e(l).evaluation_date),()=>Ge(e(l).evaluation_date),()=>de(e(l).created_at)],Ne),v("click",et,Je),v("click",nt,He),$(b,f)},d=b=>{var f=jt();$(b,f)};ne(s,b=>{e(l)?b(p):b(d,!1)},n)}};ne(Ve,s=>{e(K)?s(Xe):s(Ye,!1)})}$(Ue,ve),ft(),qe()}export{Ht as component};
