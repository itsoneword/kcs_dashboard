import{f as n,a as l,c as et,t as Be,b as lt}from"../chunks/z1_h_S-m.js";import{i as at}from"../chunks/CKvl8f00.js";import{p as tt,h as ot,aI as ct,D as ut,b as r,c as t,r as a,a as rt,m as A,o as nt,s as i,l as oa,g as e,k as dt,f as Sa,n as Pe,t as m,i as Ge,d as ge,e as na,$ as _t}from"../chunks/DO95TrpH.js";import{e as Ie,s as u,h as mt}from"../chunks/DePN81sB.js";import{i as p}from"../chunks/i89i58Dp.js";import{k as gt}from"../chunks/CfKK4Vti.js";import{e as xe,i as be}from"../chunks/KzdxLMOR.js";import{s as st}from"../chunks/B0rVqcg2.js";import{b as Xe}from"../chunks/DWPWRXnJ.js";import{s as pt,a as ft}from"../chunks/DXMp_b0k.js";import{p as ht}from"../chunks/CLGsUtju.js";import{g as it}from"../chunks/BvPgAsJ_.js";import{t as ye}from"../chunks/BCl9OAM7.js";import{b as Ne,a as xt}from"../chunks/VlzhU-cE.js";import{S as bt}from"../chunks/TRfbXqLr.js";import{p as Qe}from"../chunks/BytzElXY.js";import{M as Ua,H as yt}from"../chunks/CETgoX9I.js";import{s as ba}from"../chunks/DPUg7jpB.js";import{b as wt}from"../chunks/Dpj2xf13.js";var kt=n('<div class="container mx-auto px-4 bg-white rounded-lg shadow-md p-6 mb-6"><h2 class="text-lg font-semibold mb-4">Filters</h2> <div class="grid grid-cols-1 md:grid-cols-5 gap-4"><div><label class="block text-sm font-medium text-gray-700 mb-1">Engineer</label> <!></div> <div><label class="block text-sm font-medium text-gray-700 mb-1">Coach</label> <!></div> <div><label class="block text-sm font-medium text-gray-700 mb-1">Lead</label> <!></div> <div><label class="block text-sm font-medium text-gray-700 mb-1">Year</label> <!></div> <div><label class="block text-sm font-medium text-gray-700 mb-1">Month</label> <!></div></div> <div class="flex gap-2 mt-4"><button class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">Apply Filters</button> <button class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors">Clear Filters</button></div></div>');function Et(Ma,we){tt(we,!1);let da=Qe(we,"engineers",24,()=>[]),ta=Qe(we,"coaches",24,()=>[]),Fa=Qe(we,"leads",24,()=>[]),ne=Qe(we,"years",24,()=>[]),va=Qe(we,"months",24,()=>[]),R=Qe(we,"selectedEngineers",28,()=>[]),J=Qe(we,"selectedCoaches",28,()=>[]),ve=Qe(we,"selectedLeads",28,()=>[]),f=Qe(we,"selectedYears",28,()=>[]),y=Qe(we,"selectedMonths",28,()=>[]);const Te=ot(),x=ut(null);ct("dropdownGroup",{openDropdown:x});function w(){Te("change",{engineers:R(),coaches:J(),leads:ve(),years:f(),months:y()})}function U(){R([]),J([]),ve([]),f([]),y([]),w()}at();var q=kt(),ae=r(t(q),2),b=t(ae),Oe=r(t(b),2);Ua(Oe,{group:"engineer",get options(){return da()},placeholder:"All Engineers",searchPlaceholder:"Search engineers...",get values(){return R()},set values(Me){R(Me)},$$legacy:!0}),a(b);var pe=r(b,2),Ze=r(t(pe),2);Ua(Ze,{group:"coach",get options(){return ta()},placeholder:"All Coaches",searchPlaceholder:"Search coaches...",get values(){return J()},set values(Me){J(Me)},$$legacy:!0}),a(pe);var $=r(pe,2),We=r(t($),2);Ua(We,{group:"lead",get options(){return Fa()},placeholder:"All Leads",searchPlaceholder:"Search leads...",get values(){return ve()},set values(Me){ve(Me)},$$legacy:!0}),a($);var je=r($,2),La=r(t(je),2);Ua(La,{group:"year",get options(){return ne()},placeholder:"All Years",searchPlaceholder:"Search years...",get values(){return f()},set values(Me){f(Me)},$$legacy:!0}),a(je);var ca=r(je,2),ua=r(t(ca),2);Ua(ua,{group:"month",get options(){return va()},placeholder:"All Months",searchPlaceholder:"Search months...",get values(){return y()},set values(Me){y(Me)},$$legacy:!0}),a(ca),a(ae);var ya=r(ae,2),wa=t(ya),_a=r(wa,2);a(ya),a(q),Ie("click",wa,w),Ie("click",_a,U),l(Ma,q),rt()}var Ct=n("<li> </li>"),It=n('<p class="text-sm text-gray-600 mt-2"> </p> <ul class="list-disc ml-5 text-sm text-gray-600"></ul>',1),At=n("<option> </option>"),St=n('<div><label class="block text-sm font-medium text-gray-700 mb-2">Import As Role</label> <select class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"><option>Coach</option><option>Lead</option><option>Admin</option></select> <p class="text-xs text-gray-500 mt-1">Coach role skips conflicts, Admin allows reassignment</p></div>'),Mt=n('<div class="animate-spin rounded-full h-4 w-4 border-b-2 border-white"></div>'),Ft=n('<div class="space-y-6"><div><label class="block text-sm font-medium text-gray-700 mb-2">Excel File (.xlsx, .xlsm) *</label> <input type="file" multiple accept=".xlsx,.xlsm,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/vnd.ms-excel.sheet.macroEnabled.12" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"/> <!></div> <div class="grid grid-cols-2 gap-4"><div><label class="block text-sm font-medium text-gray-700 mb-2">Import Year *</label> <select class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"></select></div> <!></div> <div class="bg-blue-50 border border-blue-200 rounded-md p-4"><h4 class="font-medium text-blue-900 mb-2">File Requirements:</h4> <ul class="text-sm text-blue-800 list-disc list-inside space-y-1"><li>First sheet is summary (will be skipped)</li> <li>Each sheet = engineer name (ignore "Engineer X" empty sheets)</li> <li>A1 contains quarter (Q1, Q2, Q3, Q4)</li> <li>Column B contains case numbers</li> <li>C2-I2 contain evaluation parameter names</li> <li>Column J contains month, Column K contains notes</li> <li>H1 may contain coach name, D1 may contain engineer name</li></ul></div> <div class="flex justify-end gap-2"><button class="px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition-colors">Cancel</button> <button class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2"><!> Parse File</button></div></div>'),Lt=n('<div class="bg-red-50 border border-red-200 rounded-md p-4"><h4 class="font-medium text-red-900 mb-2">⚠️ Import Blocked - Coach Ownership Conflict</h4> <div class="text-sm text-red-800"><p class="mb-2">This Excel file appears to belong to <strong> </strong>, but you are logged in as <strong> </strong>.</p> <p class="font-medium">Only <strong> </strong> or an admin can import this file.</p> <p class="mt-2 text-red-600"> </p></div></div>'),Dt=n("<option> </option>"),Pt=n("<option> </option>"),Nt=n('<div class="flex flex-col gap-1"><label class="text-xs text-gray-700">Assign Coach:</label> <select class="px-3 py-1 border border-gray-300 rounded text-sm min-w-[150px]"><option>Select coach...</option><!></select> <label class="text-xs text-gray-700 mt-2">Assign Lead:</label> <select class="px-3 py-1 border border-gray-300 rounded text-sm min-w-[150px]"><option>Select lead...</option><!></select></div>'),jt=n("<option> </option>"),Yt=n('<div class="flex flex-col gap-1"><label class="text-xs text-gray-700">Assign Coach:</label> <select class="px-3 py-1 border border-gray-300 rounded text-sm min-w-[150px]"><option>Select coach...</option><!></select> <div class="text-xs text-gray-500 mt-1">You are the lead for this engineer.</div></div>'),Rt=n('<span class="text-sm px-2 py-1 bg-blue-100 rounded"><!></span>'),Ut=n('<div class="flex items-center justify-between bg-white p-3 rounded border"><div class="flex-1"><div class="font-medium"> </div> <div class="text-sm text-gray-600"><!></div></div> <div class="ml-4"><!></div></div>'),Bt=n('<div class="bg-blue-50 border border-blue-200 rounded-md p-4"><h4 class="font-medium text-blue-900 mb-2"> </h4> <div class="space-y-2"></div></div>'),Ot=n("<li> </li>"),qt=n('<div class="bg-red-50 border border-red-200 rounded-md p-4"><h4 class="font-medium text-red-900 mb-2"> </h4> <ul class="text-sm text-red-800 list-disc list-inside space-y-1"></ul></div>'),$t=n("<option> </option>"),Vt=n("<option> </option>"),zt=n('<div class="flex flex-col gap-1"><label class="text-xs text-gray-700">Assign Coach:</label> <select class="px-3 py-1 border border-gray-300 rounded text-sm min-w-[150px]"><option>Select coach...</option><!></select> <label class="text-xs text-gray-700 mt-2">Assign Lead:</label> <select class="px-3 py-1 border border-gray-300 rounded text-sm min-w-[150px]"><option>Select lead...</option><!></select></div>'),Qt=n("<option> </option>"),Tt=n('<div><label class="text-xs text-gray-700">Assign Coach:</label> <select class="px-3 py-1 border border-gray-300 rounded text-sm min-w-[150px]"><option>Select coach...</option><!></select> <div class="text-xs text-gray-500 mt-1">You are the lead for this engineer. You may change the coach.</div></div>'),Wt=n('<span class="text-xs text-yellow-700 bg-yellow-100 px-2 py-1 rounded">Coach does not match your account. You cannot import this evaluation.</span>'),Jt=n('<span class="text-sm px-2 py-1 bg-gray-100 rounded"> </span>'),Ht=n('<div class="flex items-center justify-between bg-white p-3 rounded border"><div class="flex-1"><div class="font-medium"> </div> <div class="text-sm text-gray-600"> </div></div> <div class="ml-4"><!></div></div>'),Kt=n('<div class="bg-yellow-50 border border-yellow-200 rounded-md p-4"><h4 class="font-medium text-yellow-900 mb-2"> </h4> <div class="text-sm text-yellow-900 mb-2"><span>There is a mismatch between the coach in the uploaded file and the current database for these engineers. Please resolve the conflict below.</span></div> <div class="space-y-3"></div></div>'),Gt=n('<div class="text-sm text-gray-600"> </div>'),Xt=n('<div class="p-3 border-b last:border-b-0"><div class="flex justify-between items-start"><div><div class="font-medium"> </div> <!></div> <div class="text-sm text-gray-500"> </div></div> <div class="text-sm text-gray-600 mt-1"> </div></div>'),Zt=n('<div class="bg-gray-50 rounded-lg p-4"><h4 class="font-medium mb-2">Import Summary</h4> <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm"><div><span class="text-gray-600">Engineers:</span> <span class="font-medium ml-1"> </span></div> <div><span class="text-gray-600">Total Cases:</span> <span class="font-medium ml-1"> </span></div> <div><span class="text-gray-600">Quarters:</span> <span class="font-medium ml-1"> </span></div> <div><span class="text-gray-600">Coach:</span> <span class="font-medium ml-1"> </span></div></div></div> <!> <!> <!> <div class="bg-white border rounded-lg overflow-hidden"><div class="px-4 py-3 bg-gray-50 border-b"><h4 class="font-medium">Engineers to Import</h4></div> <div class="max-h-60 overflow-y-auto"></div></div>',1),er=n('<div class="text-sm text-red-600 font-medium py-2">Import blocked due to ownership conflict</div>'),ar=n('<div class="animate-spin rounded-full h-4 w-4 border-b-2 border-white"></div>'),tr=n('<button class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center gap-2"><!> Import Data</button>'),rr=n('<div class="space-y-6"><!> <div class="flex justify-between"><button class="px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition-colors">← Back</button> <!></div></div>'),sr=lt('<svg class="h-6 w-6 text-green-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>'),ir=lt('<svg class="h-6 w-6 text-yellow-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.5 0L3.334 16.5c-.77.833.192 2.5 1.732 2.5z"></path></svg>'),lr=n("<li> </li>"),or=n('<div class="bg-yellow-50 border border-yellow-200 rounded-md p-4"><h4 class="font-medium text-yellow-900 mb-2"> </h4> <ul class="text-sm text-yellow-800 list-disc list-inside"></ul></div>'),nr=n("<li> </li>"),dr=n('<div class="bg-yellow-50 border border-yellow-200 rounded-md p-4 mt-4"><h4 class="font-medium text-yellow-900 mb-2">Warnings</h4> <ul class="text-sm text-yellow-800 list-disc list-inside space-y-1"></ul></div>'),vr=n("<li> </li>"),cr=n('<div class="bg-red-50 border border-red-200 rounded-md p-4 mt-4"><h4 class="font-medium text-red-900 mb-2"> </h4> <ul class="text-sm text-red-800 list-disc list-inside space-y-1"></ul></div>'),ur=n('<div class="space-y-6"><div class="text-center"><div><!></div> <h3 class="text-lg font-medium text-gray-900"> </h3></div> <div class="bg-gray-50 rounded-lg p-4"><h4 class="font-medium mb-3">Import Results</h4> <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm"><div class="text-center"><div class="text-2xl font-bold text-blue-600"> </div> <div class="text-gray-600">Engineers</div></div> <div class="text-center"><div class="text-2xl font-bold text-green-600"> </div> <div class="text-gray-600">Evaluations</div></div> <div class="text-center"><div class="text-2xl font-bold text-purple-600"> </div> <div class="text-gray-600">Cases</div></div> <div class="text-center"><div class="text-2xl font-bold text-orange-600"> </div> <div class="text-gray-600">Skipped</div></div></div></div> <div class="bg-blue-50 border border-blue-200 rounded-md p-4 mt-4"><h4 class="font-medium text-blue-900 mb-2">Import Summary</h4> <p class="text-sm text-blue-800"> </p> <div class="mt-2 space-x-4"><a href="/lead" class="text-blue-600 underline">View Engineers</a> <a href="/evaluations" class="text-blue-600 underline">View Evaluations</a></div></div> <!> <!> <!> <div class="flex justify-center"><button class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">Close</button></div></div>'),_r=n('<div class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50"><div class="relative top-4 mx-auto p-6 border w-full max-w-4xl shadow-lg rounded-md bg-white m-4"><div class="flex justify-between items-center mb-6"><h3 class="text-xl font-semibold text-gray-900">Excel Import - <!></h3> <button class="text-gray-400 hover:text-gray-600">✕</button></div> <div class="mb-6"><div class="flex items-center"><div class="flex items-center text-sm"><div><div><!></div> Upload</div> <div class="mx-2 text-gray-300">→</div> <div><div><!></div> Preview</div> <div class="mx-2 text-gray-300">→</div> <div><div>3</div> Import</div></div></div></div> <!> <!> <!></div></div>');function mr(Ma,we){var Oa,qa;tt(we,!1);const da=A(),ta=A();let Fa=Qe(we,"show",8,!1),ne=Qe(we,"user",8,null);const va=ot();let R=A("upload"),J=A(!1),ve=A([]),f=A(new Date().getFullYear()),y=A((Oa=ne())!=null&&Oa.is_admin||(qa=ne())!=null&&qa.is_manager?"admin":"coach"),Te=[],x=A(null),w=A({}),U=A({}),q=A([]),ae=A([]),b=A(null);const Oe=new Date().getFullYear(),pe=Array.from({length:3},(o,d)=>Oe-d);let Ze=A();function $(){var o,d;i(R,"upload"),i(ve,[]),Te=[],i(x,null),i(w,{}),i(b,null),i(J,!1),i(f,new Date().getFullYear()),i(y,(o=ne())!=null&&o.is_admin||(d=ne())!=null&&d.is_manager?"admin":"coach")}function We(){var d;const o=(d=e(b))==null?void 0:d.success;$(),va("close"),o&&va("success")}function je(o){const d=o.target;i(ve,d.files?Array.from(d.files):[]),e(ve).length===0&&ye.add({type:"warning",message:"Please select at least one file"})}async function La(){var o,d,V,Ye;if((e(y)==="admin"||e(y)==="lead")&&await ua(),e(ve).length===0){ye.add({type:"warning",message:"Please select files first"});return}try{i(J,!0);const se=[];for(const Fe of e(ve))se.push(await Ne.importExcelPreview(Fe,e(f),(o=ne())!=null&&o.is_admin||(d=ne())!=null&&d.is_manager?e(y):void 0));Te=se.map(Fe=>Fe.preview),i(x,Da(Te)),await ca(),ya(),i(R,"preview"),e(x).errors.length>0?ye.add({type:"warning",message:`Parsed ${e(x).errors.length} warning(s). Please review.`}):ye.add({type:"success",message:"Files parsed successfully."})}catch(se){console.error("Upload error:",se);const Fe=((Ye=(V=se.response)==null?void 0:V.data)==null?void 0:Ye.error)||se.message||"Failed to parse Excel file";ye.add({type:"error",message:Fe})}finally{i(J,!1)}}async function ca(){try{const o=await Ne.getAllUsers();i(q,o.users.filter(d=>d.is_coach&&!d.deleted_at)),e(q).sort((d,V)=>d.name.localeCompare(V.name)),console.log("Available coaches loaded:",e(q).length)}catch(o){console.error("Failed to load coaches:",o),ye.add({type:"warning",message:"Failed to load available coaches"})}}async function ua(){try{const o=await Ne.getAllUsers();i(ae,o.users.filter(d=>(d.is_lead||d.is_manager||d.is_admin)&&!d.deleted_at)),e(ae).sort((d,V)=>d.name.localeCompare(V.name)),console.log("Available leads loaded:",e(ae).length)}catch(o){console.error("Failed to load leads:",o),ye.add({type:"warning",message:"Failed to load available leads"})}}function ya(){!e(x)||!ne()||(i(w,{}),i(U,{}),e(x).conflicts.forEach(o=>{e(y)==="admin"||e(y)==="lead"?(ge(w,e(w)[o.engineer_name]=0),ge(U,e(U)[o.engineer_name]=0)):e(y)==="lead"?(ge(w,e(w)[o.engineer_name]=0),ge(U,e(U)[o.engineer_name]=ne().id)):e(y)==="coach"&&(o.action==="skip"?ge(w,e(w)[o.engineer_name]=-1):ge(w,e(w)[o.engineer_name]=0))}),e(x).missing_coaches.forEach(o=>{o.suggested_action==="manual_select"&&(ge(w,e(w)[o.engineer_name]=0),e(y)==="admin"||e(y)==="lead"?ge(U,e(U)[o.engineer_name]=0):e(y)==="lead"&&ge(U,e(U)[o.engineer_name]=ne().id))}))}async function wa(){var o,d,V,Ye;if(!(!e(ve)||!e(x)))try{i(J,!0);const se=[];for(const Fe of e(ve))se.push(await Ne.importExcelData(Fe,e(f),e(w),(o=ne())!=null&&o.is_admin||(d=ne())!=null&&d.is_manager?e(y):void 0));i(b,Ta(se)),i(R,"results"),e(b).success?ye.add({type:"success",message:"Import completed successfully!"}):ye.add({type:"warning",message:"Import completed with errors."})}catch(se){console.error("Import error:",se);const Fe=((Ye=(V=se.response)==null?void 0:V.data)==null?void 0:Ye.error)||se.message||"Import failed";ye.add({type:"error",message:Fe})}finally{i(J,!1)}}function _a(o){switch(o){case"skip":return"Skip (keep current coach)";case"reassign":return"Reassign to Excel coach";case"manual":return"Manual selection required";default:return o}}function Me(){return!(!e(x)||e(x).coach_ownership_warning)}nt(()=>{var o,d,V;(o=ne())!=null&&o.is_admin||(d=ne())!=null&&d.is_manager?i(y,"admin"):(V=ne())!=null&&V.is_lead?i(y,"lead"):i(y,"coach")});function Da(o){const d=o.flatMap(s=>s.engineers),V=o.flatMap(s=>s.conflicts),Ye=o.flatMap(s=>s.missing_coaches),se=o.flatMap(s=>s.errors),Fe=o.reduce((s,c)=>s+c.metadata.total_cases,0),ka=o.flatMap(s=>s.metadata.quarters_found),Pa=o.map(s=>s.metadata.file_name).join(", "),ma=o.map(s=>s.coach_ownership_warning).filter(Boolean),ga=ma.find(s=>s.should_block_import)||ma[0]||null;return{engineers:d,conflicts:V,missing_coaches:Ye,errors:se,metadata:{coach_name:null,total_cases:Fe,quarters_found:ka,file_name:Pa},coach_ownership_warning:ga}}function Ta(o){return{success:o.every(d=>d.result.success),imported_engineers:o.reduce((d,V)=>d+V.result.imported_engineers,0),imported_evaluations:o.reduce((d,V)=>d+V.result.imported_evaluations,0),imported_cases:o.reduce((d,V)=>d+V.result.imported_cases,0),skipped_engineers:o.flatMap(d=>d.result.skipped_engineers),errors:o.flatMap(d=>d.result.errors)}}oa(()=>e(b),()=>{i(da,e(b)?e(b).errors.filter(o=>o.includes("No active coach assignment")):[])}),oa(()=>e(b),()=>{i(ta,e(b)?e(b).errors.filter(o=>!o.includes("No active coach assignment")):[])}),dt(),at();var Ba=et(),Wa=Sa(Ba);{var Ja=o=>{var d=_r(),V=t(d),Ye=t(V),se=t(Ye),Fe=r(t(se));{var ka=S=>{var z=Be("Upload File");l(S,z)},Pa=(S,z)=>{{var Ae=ie=>{var v=Be("Review Data");l(ie,v)},Ee=ie=>{var v=Be("Import Results");l(ie,v)};p(S,ie=>{e(R)==="preview"?ie(Ae):ie(Ee,!1)},z)}};p(Fe,S=>{e(R)==="upload"?S(ka):S(Pa,!1)})}a(se);var ma=r(se,2);a(Ye);var ga=r(Ye,2),s=t(ga),c=t(s),_=t(c),E=t(_),ce=t(E);{var ke=S=>{var z=Be("1");l(S,z)},Ke=S=>{var z=Be("✓");l(S,z)};p(ce,S=>{e(R)==="upload"?S(ke):S(Ke,!1)})}a(E),Pe(),a(_);var Je=r(_,4),qe=t(Je),ze=t(qe);{var $a=S=>{var z=Be("2");l(S,z)},Ha=(S,z)=>{{var Ae=ie=>{var v=Be("✓");l(ie,v)},Ee=ie=>{var v=Be("2");l(ie,v)};p(S,ie=>{e(R)==="results"?ie(Ae):ie(Ee,!1)},z)}};p(ze,S=>{e(R)==="preview"?S($a):S(Ha,!1)})}a(qe),Pe(),a(Je);var Na=r(Je,4),Ka=t(Na);Pe(),a(Na),a(c),a(s),a(ga);var Va=r(ga,2);{var ja=S=>{var z=Ft(),Ae=t(z),Ee=r(t(Ae),2);wt(Ee,F=>i(Ze,F),()=>e(Ze));var ie=r(Ee,2);{var v=F=>{var N=It(),j=Sa(N),oe=t(j);a(j);var C=r(j,2);xe(C,5,()=>e(ve),be,(Z,Q)=>{var ue=Ct(),$e=t(ue);a(ue),m(ea=>u($e,`${e(Q).name??""} (${ea??""} MB)`),[()=>(e(Q).size/1024/1024).toFixed(2)],na),l(Z,ue)}),a(C),m(()=>u(oe,`Selected ${e(ve).length??""} file(s):`)),l(F,N)};p(ie,F=>{e(ve).length>0&&F(v)})}a(Ae);var B=r(Ae,2),fe=t(B),Ce=r(t(fe),2);m(()=>{e(f),Ge(()=>{e(J)})}),xe(Ce,5,()=>pe,be,(F,N)=>{var j=At(),oe={},C=t(j,!0);a(j),m(()=>{oe!==(oe=e(N))&&(j.value=(j.__value=e(N))??""),u(C,e(N))}),l(F,j)}),a(Ce),a(fe);var te=r(fe,2);{var M=F=>{var N=St(),j=r(t(N),2);m(()=>{e(y),Ge(()=>{e(J)})});var oe=t(j);oe.value=oe.__value="coach";var C=r(oe);C.value=C.__value="lead";var Z=r(C);Z.value=Z.__value="admin",a(j),Pe(2),a(N),m(()=>j.disabled=e(J)),Xe(j,()=>e(y),Q=>i(y,Q)),l(F,N)};p(te,F=>{var N;(N=ne())!=null&&N.is_admin&&F(M)})}a(B);var P=r(B,4),X=t(P),H=r(X,2),h=t(H);{var le=F=>{var N=Mt();l(F,N)};p(h,F=>{e(J)&&F(le)})}Pe(),a(H),a(P),a(z),m(()=>{Ee.disabled=e(J),Ce.disabled=e(J),X.disabled=e(J),H.disabled=!e(ve).length||e(J)}),Ie("change",Ee,je),Xe(Ce,()=>e(f),F=>i(f,F)),Ie("click",X,We),Ie("click",H,La),l(S,z)};p(Va,S=>{e(R)==="upload"&&S(ja)})}var za=r(Va,2);{var Ga=S=>{var z=rr(),Ae=t(z);{var Ee=M=>{var P=Lt(),X=r(t(P),2),H=t(X),h=r(t(H)),le=t(h,!0);a(h);var F=r(h,2),N=t(F,!0);a(F),Pe(),a(H);var j=r(H,2),oe=r(t(j)),C=t(oe,!0);a(oe),Pe(),a(j);var Z=r(j,2),Q=t(Z);a(Z),a(X),a(P),m(()=>{u(le,e(x).coach_ownership_warning.detected_coach),u(N,e(x).coach_ownership_warning.importing_user),u(C,e(x).coach_ownership_warning.detected_coach),u(Q,`Please contact your administrator or ask ${e(x).coach_ownership_warning.detected_coach??""} to perform the import.`)}),l(M,P)},ie=M=>{var P=Zt(),X=Sa(P),H=r(t(X),2),h=t(H),le=r(t(h),2),F=t(le,!0);a(le),a(h);var N=r(h,2),j=r(t(N),2),oe=t(j,!0);a(j),a(N);var C=r(N,2),Z=r(t(C),2),Q=t(Z,!0);a(Z),a(C);var ue=r(C,2),$e=r(t(ue),2),ea=t($e,!0);a($e),a(ue),a(H),a(X);var ra=r(X,2);{var Ya=k=>{var I=Bt(),L=t(I),ee=t(L);a(L);var O=r(L,2);xe(O,5,()=>e(x).missing_coaches,be,(re,g)=>{var K=Ut(),_e=t(K),Re=t(_e),ha=t(Re,!0);a(Re);var ia=r(Re,2),Ra=t(ia);{var Ue=de=>{var Se=Be();m(()=>u(Se,`Excel coach "${e(g).excel_coach_name??""}" not found
                            in database`)),l(de,Se)},He=de=>{var Se=Be("No coach specified in Excel");l(de,Se)};p(Ra,de=>{e(g).excel_coach_name?de(Ue):de(He,!1)})}a(ia),a(_e);var Ia=r(_e,2),Za=t(Ia);{var la=de=>{var Se=Nt(),Le=r(t(Se),2);m(()=>{e(w),Ge(()=>{e(g),e(q)})});var De=t(Le);De.value=De.__value=0;var he=r(De);xe(he,1,()=>e(q),be,(Y,D)=>{var W=Dt(),Ve={},Aa=t(W,!0);a(W),m(()=>{Ve!==(Ve=e(D).id)&&(W.value=(W.__value=e(D).id)??""),u(Aa,e(D).name)}),l(Y,W)}),a(Le);var me=r(Le,4);m(()=>{e(U),Ge(()=>{e(g),e(ae)})});var T=t(me);T.value=T.__value=0;var G=r(T);xe(G,1,()=>e(ae),be,(Y,D)=>{var W=Pt(),Ve={},Aa=t(W,!0);a(W),m(()=>{Ve!==(Ve=e(D).id)&&(W.value=(W.__value=e(D).id)??""),u(Aa,e(D).name)}),l(Y,W)}),a(me),a(Se),Xe(Le,()=>e(w)[e(g).engineer_name],Y=>ge(w,e(w)[e(g).engineer_name]=Y)),Xe(me,()=>e(U)[e(g).engineer_name],Y=>ge(U,e(U)[e(g).engineer_name]=Y)),l(de,Se)},xa=(de,Se)=>{{var Le=he=>{var me=Yt(),T=r(t(me),2);m(()=>{e(w),Ge(()=>{e(g),e(q)})});var G=t(T);G.value=G.__value=0;var Y=r(G);xe(Y,1,()=>e(q),be,(D,W)=>{var Ve=jt(),Aa={},vt=t(Ve,!0);a(Ve),m(()=>{Aa!==(Aa=e(W).id)&&(Ve.value=(Ve.__value=e(W).id)??""),u(vt,e(W).name)}),l(D,Ve)}),a(T),Pe(2),a(me),Xe(T,()=>e(w)[e(g).engineer_name],D=>ge(w,e(w)[e(g).engineer_name]=D)),l(he,me)},De=he=>{var me=Rt(),T=t(me);{var G=D=>{var W=Be("Will assign to you");l(D,W)},Y=D=>{var W=Be("Manual selection required");l(D,W)};p(T,D=>{e(g).suggested_action==="assign_to_importer"?D(G):D(Y,!1)})}a(me),l(he,me)};p(de,he=>{e(g).suggested_action==="manual_select"&&e(y)==="lead"?he(Le):he(De,!1)},Se)}};p(Za,de=>{e(g).suggested_action==="manual_select"&&(e(y)==="admin"||e(y)==="lead")?de(la):de(xa,!1)})}a(Ia),a(K),m(()=>u(ha,e(g).engineer_name)),l(re,K)}),a(O),a(I),m(()=>u(ee,`Coach Assignment Information (${e(x).missing_coaches.length??""})`)),l(k,I)};p(ra,k=>{e(x).missing_coaches.length>0&&k(Ya)})}var aa=r(ra,2);{var Ea=k=>{var I=qt(),L=t(I),ee=t(L);a(L);var O=r(L,2);xe(O,5,()=>e(x).errors,be,(re,g)=>{var K=Ot(),_e=t(K,!0);a(K),m(()=>u(_e,e(g))),l(re,K)}),a(O),a(I),m(()=>u(ee,`Parsing Warnings (${e(x).errors.length??""})`)),l(k,I)};p(aa,k=>{e(x).errors.length>0&&k(Ea)})}var pa=r(aa,2);{var Ca=k=>{var I=Kt(),L=t(I),ee=t(L);a(L);var O=r(L,4);xe(O,5,()=>e(x).conflicts,be,(re,g)=>{var K=Ht(),_e=t(K),Re=t(_e),ha=t(Re,!0);a(Re);var ia=r(Re,2),Ra=t(ia);a(ia),a(_e);var Ue=r(_e,2),He=t(Ue);{var Ia=la=>{var xa=zt(),de=r(t(xa),2);m(()=>{e(w),Ge(()=>{e(g),e(q)})});var Se=t(de);Se.value=Se.__value=0;var Le=r(Se);xe(Le,1,()=>e(q),be,(T,G)=>{var Y=$t(),D={},W=t(Y,!0);a(Y),m(()=>{D!==(D=e(G).id)&&(Y.value=(Y.__value=e(G).id)??""),u(W,e(G).name)}),l(T,Y)}),a(de);var De=r(de,4);m(()=>{e(U),Ge(()=>{e(g),e(ae)})});var he=t(De);he.value=he.__value=0;var me=r(he);xe(me,1,()=>e(ae),be,(T,G)=>{var Y=Vt(),D={},W=t(Y,!0);a(Y),m(()=>{D!==(D=e(G).id)&&(Y.value=(Y.__value=e(G).id)??""),u(W,e(G).name)}),l(T,Y)}),a(De),a(xa),Xe(de,()=>e(w)[e(g).engineer_name],T=>ge(w,e(w)[e(g).engineer_name]=T)),Xe(De,()=>e(U)[e(g).engineer_name],T=>ge(U,e(U)[e(g).engineer_name]=T)),l(la,xa)},Za=(la,xa)=>{{var de=Le=>{var De=Tt(),he=r(t(De),2);m(()=>{e(w),Ge(()=>{e(g),e(q)})});var me=t(he);me.value=me.__value=0;var T=r(me);xe(T,1,()=>e(q),be,(G,Y)=>{var D=Qt(),W={},Ve=t(D,!0);a(D),m(()=>{W!==(W=e(Y).id)&&(D.value=(D.__value=e(Y).id)??""),u(Ve,e(Y).name)}),l(G,D)}),a(he),Pe(2),a(De),Xe(he,()=>e(w)[e(g).engineer_name],G=>ge(w,e(w)[e(g).engineer_name]=G)),l(Le,De)},Se=(Le,De)=>{{var he=T=>{var G=Wt();l(T,G)},me=T=>{var G=Jt(),Y=t(G,!0);a(G),m(D=>u(Y,D),[()=>_a(e(g).action)],na),l(T,G)};p(Le,T=>{e(y)==="coach"?T(he):T(me,!1)},De)}};p(la,Le=>{e(y)==="lead"?Le(de):Le(Se,!1)},xa)}};p(He,la=>{(e(y)==="admin"||e(y)==="lead")&&e(g).action==="manual"?la(Ia):la(Za,!1)})}a(Ue),a(K),m(()=>{u(ha,e(g).engineer_name),u(Ra,`Current: ${e(g).current_coach??""} → Excel: ${e(g).excel_coach||"Not specified"}`)}),l(re,K)}),a(O),a(I),m(()=>u(ee,`Coach Assignment Conflicts (${e(x).conflicts.length??""})`)),l(k,I)};p(pa,k=>{e(x).conflicts.length>0&&k(Ca)})}var sa=r(pa,2),fa=r(t(sa),2);xe(fa,5,()=>e(x).engineers,be,(k,I)=>{var L=Xt(),ee=t(L),O=t(ee),re=t(O),g=t(re,!0);a(re);var K=r(re,2);{var _e=Ue=>{var He=Gt(),Ia=t(He);a(He),m(()=>u(Ia,`Coach: ${e(I).coach_name??""}`)),l(Ue,He)};p(K,Ue=>{e(I).coach_name&&Ue(_e)})}a(O);var Re=r(O,2),ha=t(Re);a(Re),a(ee);var ia=r(ee,2),Ra=t(ia);a(ia),a(L),m((Ue,He)=>{u(g,e(I).name),u(ha,`${Ue??""} cases`),u(Ra,`Quarters: ${He??""}`)},[()=>e(I).evaluations.reduce((Ue,He)=>Ue+He.cases.length,0),()=>e(I).evaluations.map(Ue=>Ue.quarter).join(", ")],na),l(k,L)}),a(fa),a(sa),m(k=>{u(F,e(x).engineers.length),u(oe,e(x).metadata.total_cases),u(Q,k),u(ea,e(x).metadata.coach_name||"Various")},[()=>e(x).metadata.quarters_found.join(", ")],na),l(M,P)};p(Ae,M=>{e(x).coach_ownership_warning?M(Ee):M(ie,!1)})}var v=r(Ae,2),B=t(v),fe=r(B,2);{var Ce=M=>{var P=er();l(M,P)},te=M=>{var P=tr(),X=t(P);{var H=h=>{var le=ar();l(h,le)};p(X,h=>{e(J)&&h(H)})}Pe(),a(P),m(h=>P.disabled=h,[()=>!Me()||e(J)],na),Ie("click",P,wa),l(M,P)};p(fe,M=>{e(x).coach_ownership_warning?M(Ce):M(te,!1)})}a(v),a(z),m(()=>B.disabled=e(J)),Ie("click",B,()=>i(R,"upload")),l(S,z)};p(za,S=>{e(R)==="preview"&&e(x)&&S(Ga)})}var Xa=r(za,2);{var Qa=S=>{var z=ur(),Ae=t(z),Ee=t(Ae),ie=t(Ee);{var v=k=>{var I=sr();l(k,I)},B=k=>{var I=ir();l(k,I)};p(ie,k=>{e(b).success?k(v):k(B,!1)})}a(Ee);var fe=r(Ee,2),Ce=t(fe,!0);a(fe),a(Ae);var te=r(Ae,2),M=r(t(te),2),P=t(M),X=t(P),H=t(X,!0);a(X),Pe(2),a(P);var h=r(P,2),le=t(h),F=t(le,!0);a(le),Pe(2),a(h);var N=r(h,2),j=t(N),oe=t(j,!0);a(j),Pe(2),a(N);var C=r(N,2),Z=t(C),Q=t(Z,!0);a(Z),Pe(2),a(C),a(M),a(te);var ue=r(te,2),$e=r(t(ue),2),ea=t($e);a($e),Pe(2),a(ue);var ra=r(ue,2);{var Ya=k=>{var I=or(),L=t(I),ee=t(L);a(L);var O=r(L,2);xe(O,5,()=>e(b).skipped_engineers,be,(re,g)=>{var K=lr(),_e=t(K,!0);a(K),m(()=>u(_e,e(g))),l(re,K)}),a(O),a(I),m(()=>u(ee,`Skipped Engineers (${e(b).skipped_engineers.length??""})`)),l(k,I)};p(ra,k=>{e(b).skipped_engineers.length>0&&k(Ya)})}var aa=r(ra,2);{var Ea=k=>{var I=dr(),L=r(t(I),2);xe(L,5,()=>e(da),be,(ee,O)=>{var re=nr(),g=t(re,!0);a(re),m(()=>u(g,e(O))),l(ee,re)}),a(L),a(I),l(k,I)};p(aa,k=>{e(da).length>0&&k(Ea)})}var pa=r(aa,2);{var Ca=k=>{var I=cr(),L=t(I),ee=t(L);a(L);var O=r(L,2);xe(O,5,()=>e(ta),be,(re,g)=>{var K=vr(),_e=t(K,!0);a(K),m(()=>u(_e,e(g))),l(re,K)}),a(O),a(I),m(()=>u(ee,`Errors (${e(ta).length??""})`)),l(k,I)};p(pa,k=>{e(ta).length>0&&k(Ca)})}var sa=r(pa,2),fa=t(sa);a(sa),a(z),m(()=>{ba(Ee,1,`mx-auto flex items-center justify-center h-12 w-12 rounded-full ${e(b).success?"bg-green-100":"bg-yellow-100"} mb-4`),u(Ce,e(b).success?"Import Completed Successfully!":"Import Completed with Issues"),u(H,e(b).imported_engineers),u(F,e(b).imported_evaluations),u(oe,e(b).imported_cases),u(Q,e(b).skipped_engineers.length),u(ea,`Imported ${e(b).imported_engineers??""} engineers and ${e(b).imported_evaluations??""} evaluations with ${e(b).imported_cases??""} cases successfully.`)}),Ie("click",fa,We),l(S,z)};p(Xa,S=>{e(R)==="results"&&e(b)&&S(Qa)})}a(V),a(d),m(()=>{ma.disabled=e(J),ba(_,1,`flex items-center ${e(R)==="upload"?"text-blue-600":"text-green-600"}`),ba(E,1,`w-6 h-6 rounded-full border-2 ${e(R)==="upload"?"border-blue-600 bg-blue-100":"border-green-600 bg-green-100"} flex items-center justify-center mr-2`),ba(Je,1,`flex items-center ${e(R)==="preview"?"text-blue-600":e(R)==="results"?"text-green-600":"text-gray-400"}`),ba(qe,1,`w-6 h-6 rounded-full border-2 ${e(R)==="preview"?"border-blue-600 bg-blue-100":e(R)==="results"?"border-green-600 bg-green-100":"border-gray-300"} flex items-center justify-center mr-2`),ba(Na,1,`flex items-center ${e(R)==="results"?"text-blue-600":"text-gray-400"}`),ba(Ka,1,`w-6 h-6 rounded-full border-2 ${e(R)==="results"?"border-blue-600 bg-blue-100":"border-gray-300"} flex items-center justify-center mr-2`)}),Ie("click",ma,We),l(o,d)};p(Wa,o=>{Fa()&&o(Ja)})}l(Ma,Ba),rt()}var gr=n('<div class="flex justify-center items-center py-8"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div></div>'),pr=n('<div class="text-center py-8"><p class="text-gray-500">Please log in to view evaluations.</p> <a href="/auth/login" class="text-blue-600 hover:text-blue-800">Login</a></div>'),fr=n('<button class="btn-secondary text-sm">My Workers</button>'),hr=n('<button class="btn-secondary text-sm flex items-center gap-2"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10"></path></svg> Import Excel</button> <button class="btn-primary text-sm">Create Evaluation</button>',1),xr=n('<div class="flex justify-center items-center py-8"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div></div>'),br=n('<div class="text-center py-8 text-gray-500">No evaluations found. <!></div>'),yr=n('<div class="relative inline-block text-left overflow-visible"><button class="dropdown-toggle cursor-pointer text-gray-600 hover:text-gray-900 px-1" aria-haspopup="true">⋮</button> <div class="dropdown-menu hidden origin-top-right absolute right-0 mt-1 bg-white border border-gray-200 rounded shadow text-sm w-32 z-50" role="menu" aria-orientation="vertical"><button class="block w-full px-4 py-2 hover:bg-gray-100 text-left text-red-600" role="menuitem">Delete evaluation</button></div></div>'),wr=n('<tr class="hover:bg-gray-50"><td class="px-6 py-4 whitespace-nowrap"><div class="text-sm font-medium text-gray-900"> </div></td><td class="px-6 py-4 whitespace-nowrap"><div class="text-sm text-gray-900"> </div></td><td class="px-6 py-4 whitespace-nowrap"><div class="text-sm text-gray-900"> </div></td><td class="px-6 py-4 whitespace-nowrap"><div class="text-sm text-gray-900"> </div></td><td class="px-6 py-4 whitespace-nowrap"><div class="text-sm text-gray-900"> </div></td><td class="px-6 py-4 whitespace-nowrap text-sm font-medium overflow-visible"><div class="flex items-center gap-2"><button class="text-blue-600 hover:text-blue-900">View Details</button> <!></div></td></tr>'),kr=n('<div class="overflow-x-auto overflow-visible"><table class="min-w-full divide-y divide-gray-200"><thead class="bg-gray-50"><tr><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Engineer</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Coach</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Lead</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Evaluated Month</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Cases</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th></tr></thead><tbody class="bg-white divide-y divide-gray-200"></tbody></table></div>'),Er=n('<div class="text-center py-8 text-gray-500">No evaluations found. <!></div>'),Cr=n("<option> </option>"),Ir=n("<option> </option>"),Ar=n('<div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"><div class="bg-white rounded-lg p-6 w-full max-w-md"><h3 class="text-lg font-medium mb-4">Create New Evaluation</h3> <div class="space-y-4"><div><label class="block text-sm font-medium text-gray-700 mb-1">Engineer *</label> <!></div> <div class="grid grid-cols-2 gap-4"><div><label class="block text-sm font-medium text-gray-700 mb-1">Month *</label> <select class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"></select></div> <div><label class="block text-sm font-medium text-gray-700 mb-1">Year *</label> <select class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"></select></div></div> <div class="flex justify-end gap-2"><button class="px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition-colors">Cancel</button> <button class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">Create</button></div></div></div></div>'),Sr=n('<div class="min-h-screen bg-gray-50"><!> <div class="container mx-auto px-4 py-8"><div class="flex justify-between items-center mb-6"><div><h2 class="text-2xl font-bold text-gray-900">Evaluations</h2> <p class="text-gray-600">View and manage evaluations</p></div> <div class="flex items-center space-x-4"><!> <!></div></div> <!></div> <div class="container mx-auto px-4 bg-white rounded-lg shadow-md overflow-visible mt-6 max-h-[600px] overflow-visible"><!></div> <!> <!> <!></div>');function Jr(Ma,we){tt(we,!1);const[da,ta]=pt(),Fa=()=>ft(ht,"$page",da),ne=A(),va=A(),R=A(),J=A(),ve=A();let f=A(null);xt.subscribe(s=>{i(f,s.user)});let y=A([]),Te=A([]),x=A([]),w=A([]),U=A(!1),q=A([]),ae=A([]),b=A([]),Oe=A([]),pe=A([]),Ze=A(!1),$=A({engineer_id:0,evaluation_month:new Date().getMonth()+1,evaluation_year:new Date().getFullYear()}),We=A(!1),je=A(null);function La(s){if(e(je)&&e(je)!==s){const _=document.getElementById(e(je));_==null||_.classList.add("hidden")}const c=document.getElementById(s);c&&(c.classList.toggle("hidden"),i(je,c.classList.contains("hidden")?null:s))}function ca(){if(e(je)){const s=document.getElementById(e(je));s==null||s.classList.add("hidden"),i(je,null)}}let ua=A([]);nt(()=>{Fe(),setTimeout(()=>{Me().catch(console.error)},100);const s=c=>{const _=c.target;_.closest(".dropdown-menu")||_.closest(".dropdown-toggle")||ca()};return document.addEventListener("click",s),()=>{document.removeEventListener("click",s)}});async function ya(){try{i(U,!0);const[s,c,_]=await Promise.all([Ne.getAllEvaluations(_a()),Ne.getAllEngineers(),Ne.getAllUsers()]);i(y,s.evaluations),i(Te,c.engineers),i(x,_.users.filter(E=>E.is_coach)),i(w,_.users.filter(E=>E.is_lead||E.is_admin||E.is_manager))}catch(s){console.error("Error loading data:",s),ye.add({type:"error",message:"Failed to load data"})}finally{i(U,!1)}}async function wa(){var s,c,_;try{if((s=e(f))!=null&&s.is_coach&&!((c=e(f))!=null&&c.is_admin)&&!((_=e(f))!=null&&_.is_manager)){const E=await Ne.getEngineersByCoach(e(f).id);i(ua,E.engineers)}else{const E=await Ne.getEngineersForEvaluation();i(ua,E.engineers)}}catch(E){console.error("Error loading available engineers:",E)}}function _a(){var c;const s={};return e(q).length>1?s.engineer_ids=e(q):e(q).length===1&&(s.engineer_id=e(q)[0]),e(ae).length>1?s.coach_user_ids=e(ae):e(ae).length===1&&(s.coach_user_id=e(ae)[0]),e(b).length>1?s.lead_user_ids=e(b):e(b).length===1&&(s.lead_user_id=e(b)[0]),e(Oe).length>1?s.years=e(Oe):e(Oe).length===1&&(s.year=e(Oe)[0]),((c=e(pe))==null?void 0:c.length)>0&&(s.months=e(pe)),s}async function Me(){try{if(i(U,!0),e(pe).length>1){const _=[];for(const E of e(pe)){const ce=_a();ce.month=E;try{const ke=await Ne.getAllEvaluations(ce);_.push(...ke.evaluations)}catch(ke){console.error(`Error loading data for month ${E}:`,ke)}}i(y,_.filter((E,ce,ke)=>ce===ke.findIndex(Ke=>Ke.id===E.id)))}else{const _=_a();e(pe).length===1&&(_.month=e(pe)[0]);const E=await Ne.getAllEvaluations(_);i(y,E.evaluations)}const[s,c]=await Promise.all([Ne.getAllEngineers(),Ne.getAllUsers()]);i(Te,s.engineers),i(x,c.users.filter(_=>_.is_coach)),i(w,c.users.filter(_=>_.is_lead||_.is_admin||_.is_manager))}catch(s){console.error("Error loading data:",s),ye.add({type:"error",message:"Failed to load data"})}finally{i(U,!1)}}async function Da(){await Me()}function Ta(){var s,c;i(q,[]),i(ae,[]),i(b,[]),i(Oe,[]),i(pe,[]),(s=e(f))!=null&&s.is_coach?(i(ae,[e(f).id]),Da()):(c=e(f))!=null&&c.is_lead&&(i(b,[e(f).id]),Da())}async function Ba(){var s,c;try{if(!e($).engineer_id||!e($).evaluation_month||!e($).evaluation_year){ye.add({type:"warning",message:"Please fill in all required fields"});return}const _=`${e($).evaluation_year}-${e($).evaluation_month.toString().padStart(2,"0")}-01`,{evaluation:E}=await Ne.createEvaluation({engineer_id:e($).engineer_id,evaluation_date:_});i(Ze,!1),i($,{engineer_id:0,evaluation_month:new Date().getMonth()+1,evaluation_year:new Date().getFullYear()}),ye.add({type:"success",message:"Evaluation created successfully"}),it(`/evaluations/${E.id}`)}catch(_){console.error("Error creating evaluation:",_);const E=((c=(s=_.response)==null?void 0:s.data)==null?void 0:c.error)||"Failed to create evaluation";ye.add({type:"error",message:E})}}function Wa(s){it(`/evaluations/${s}`)}async function Ja(s){var c,_;if(confirm("Are you sure you want to delete this evaluation?"))try{await Ne.deleteEvaluation(s),ye.add({type:"success",message:"Evaluation deleted successfully"}),Me()}catch(E){console.error("Delete evaluation error:",E);const ce=((_=(c=E.response)==null?void 0:c.data)==null?void 0:_.error)||"Failed to delete evaluation";ye.add({type:"error",message:ce})}}function Oa(s){return new Date(s).toLocaleDateString("en-US",{month:"long",year:"numeric"})}function qa(s){const c=e(Te).find(_=>_.id===s);return(c==null?void 0:c.name)||"Unknown"}function o(s){const c=e(x).find(_=>_.id===s);return(c==null?void 0:c.name)||"Unknown"}const d=new Date().getFullYear(),V=Array.from({length:3},(s,c)=>d-c),Ye=[{value:1,label:"January"},{value:2,label:"February"},{value:3,label:"March"},{value:4,label:"April"},{value:5,label:"May"},{value:6,label:"June"},{value:7,label:"July"},{value:8,label:"August"},{value:9,label:"September"},{value:10,label:"October"},{value:11,label:"November"},{value:12,label:"December"}];function se(){i(We,!1),ya(),ye.add({type:"success",message:"Data imported successfully! Refreshing evaluations..."})}function Fe(){const s=new URLSearchParams(Fa().url.search),c=s.get("engineer_id");c&&!isNaN(parseInt(c))&&i(q,[parseInt(c)]);const _=s.getAll("engineer_ids");if(_.length>0){const qe=_.find(ze=>!isNaN(parseInt(ze)));qe&&i(q,[parseInt(qe)])}const E=s.get("coach_user_id");E&&!isNaN(parseInt(E))&&i(ae,[parseInt(E)]);const ce=s.get("lead_user_id");ce&&!isNaN(parseInt(ce))&&i(b,[parseInt(ce)]);const ke=s.get("year");ke&&!isNaN(parseInt(ke))&&i(Oe,[parseInt(ke)]);const Ke=s.get("month");Ke&&!isNaN(parseInt(Ke))&&i(pe,[parseInt(Ke)]);const Je=s.getAll("months");if(Je.length>0){const qe=Je.map(ze=>parseInt(ze)).filter(ze=>!isNaN(ze)&&ze>=1&&ze<=12);qe.length>0&&i(pe,qe)}console.log("Parsed URL parameters:",e(q),e(ae),e(b),e(Oe),e(pe))}oa(()=>e(Te),()=>{i(ne,e(Te).map(s=>({value:s.id,label:s.name})))}),oa(()=>e(x),()=>{i(va,e(x).map(s=>({value:s.id,label:s.name})))}),oa(()=>e(w),()=>{i(R,e(w).map(s=>({value:s.id,label:s.name})))}),oa(()=>{},()=>{i(J,V.map(s=>({value:s,label:s.toString()})))}),oa(()=>{},()=>{i(ve,Ye.map(s=>({value:s.value,label:s.label})))}),oa(()=>e(f),()=>{e(f)&&wa()}),dt(),at();var ka=et();mt(s=>{_t.title="Evaluations - KCS Portal"});var Pa=Sa(ka);{var ma=s=>{var c=gr();l(s,c)},ga=(s,c)=>{{var _=ce=>{var ke=pr();l(ce,ke)},E=ce=>{var ke=Sr(),Ke=t(ke);yt(Ke,{title:"Evaluations",get user(){return e(f)}});var Je=r(Ke,2),qe=t(Je),ze=r(t(qe),2),$a=t(ze);{var Ha=v=>{var B=fr();Ie("click",B,Ta),l(v,B)};p($a,v=>{(e(f).is_coach||e(f).is_lead||e(f).is_manager)&&v(Ha)})}var Na=r($a,2);{var Ka=v=>{var B=hr(),fe=Sa(B),Ce=r(fe,2);Ie("click",fe,()=>i(We,!0)),Ie("click",Ce,()=>i(Ze,!0)),l(v,B)};p(Na,v=>{(e(f).is_admin||e(f).is_coach||e(f).is_lead||e(f).is_manager)&&v(Ka)})}a(ze),a(qe);var Va=r(qe,2);Et(Va,{get engineers(){return e(ne)},get coaches(){return e(va)},get leads(){return e(R)},get years(){return e(J)},get months(){return e(ve)},get selectedEngineers(){return e(q)},set selectedEngineers(v){i(q,v)},get selectedCoaches(){return e(ae)},set selectedCoaches(v){i(ae,v)},get selectedLeads(){return e(b)},set selectedLeads(v){i(b,v)},get selectedYears(){return e(Oe)},set selectedYears(v){i(Oe,v)},get selectedMonths(){return e(pe)},set selectedMonths(v){i(pe,v)},$$events:{change:()=>Da()},$$legacy:!0}),a(Je);var ja=r(Je,2),za=t(ja);{var Ga=v=>{var B=xr();l(v,B)},Xa=(v,B)=>{{var fe=te=>{var M=br(),P=r(t(M));{var X=H=>{var h=Be(`Try
            creating one!`);l(H,h)};p(P,H=>{var h,le;((h=e(f))!=null&&h.is_admin||(le=e(f))!=null&&le.is_coach)&&H(X)})}a(M),l(te,M)},Ce=te=>{var M=kr(),P=t(M),X=r(t(P));xe(X,5,()=>e(y),be,(H,h)=>{var le=wr(),F=t(le),N=t(F),j=t(N,!0);a(N),a(F);var oe=r(F),C=t(oe),Z=t(C,!0);a(C),a(oe);var Q=r(oe),ue=t(Q),$e=t(ue,!0);a(ue),a(Q);var ea=r(Q),ra=t(ea),Ya=t(ra,!0);a(ra),a(ea);var aa=r(ea),Ea=t(aa),pa=t(Ea,!0);a(Ea),a(aa);var Ca=r(aa),sa=t(Ca),fa=t(sa),k=r(fa,2);{var I=L=>{var ee=et(),O=Sa(ee);gt(O,()=>e(h).id,re=>{var g=yr();const K=na(()=>`eval-dropdown-${e(h).id}`);var _e=t(g),Re=r(_e,2),ha=t(Re);a(Re),a(g),m(()=>{st(_e,"aria-expanded",e(K)===e(je)),st(Re,"id",e(K))}),Ie("click",_e,()=>La(e(K))),Ie("click",ha,()=>{Ja(e(h).id),ca()}),l(re,g)}),l(L,ee)};p(k,L=>{var ee,O,re;((ee=e(f))!=null&&ee.is_admin||(O=e(f))!=null&&O.is_coach||(re=e(f))!=null&&re.is_manager)&&L(I)})}a(sa),a(Ca),a(le),m((L,ee,O)=>{u(j,L),u(Z,ee),u($e,e(h).lead_name||"N/A"),u(Ya,O),u(pa,e(h).case_count||0)},[()=>e(h).engineer_name||qa(e(h).engineer_id),()=>e(h).coach_name||o(e(h).coach_user_id),()=>Oa(e(h).evaluation_date)],na),Ie("click",fa,()=>Wa(e(h).id)),l(H,le)}),a(X),a(P),a(M),l(te,M)};p(v,te=>{e(y).length===0?te(fe):te(Ce,!1)},B)}};p(za,v=>{e(U)?v(Ga):v(Xa,!1)})}a(ja);var Qa=r(ja,2);{var S=v=>{var B=Er(),fe=r(t(B));{var Ce=te=>{var M=Be(`Try creating
          one!`);l(te,M)};p(fe,te=>{var M,P;((M=e(f))!=null&&M.is_admin||(P=e(f))!=null&&P.is_coach)&&te(Ce)})}a(B),l(v,B)};p(Qa,v=>{!e(U)&&e(y).length===0&&v(S)})}var z=r(Qa,2);{var Ae=v=>{var B=Ar(),fe=t(B),Ce=r(t(fe),2),te=t(Ce),M=r(t(te),2);const P=na(()=>e(ua).map(C=>({value:C.id,label:C.name})));bt(M,{get options(){return e(P)},placeholder:"Select an engineer...",searchPlaceholder:"Search engineers...",get value(){return e($).engineer_id},set value(C){ge($,e($).engineer_id=C)},$$events:{change:C=>ge($,e($).engineer_id=C.detail.value)},$$legacy:!0}),a(te);var X=r(te,2),H=t(X),h=r(t(H),2);m(()=>{e($),Ge(()=>{})}),xe(h,5,()=>Ye,be,(C,Z)=>{var Q=Cr(),ue={},$e=t(Q,!0);a(Q),m(()=>{ue!==(ue=e(Z).value)&&(Q.value=(Q.__value=e(Z).value)??""),u($e,e(Z).label)}),l(C,Q)}),a(h),a(H);var le=r(H,2),F=r(t(le),2);m(()=>{e($),Ge(()=>{})}),xe(F,5,()=>V,be,(C,Z)=>{var Q=Ir(),ue={},$e=t(Q,!0);a(Q),m(()=>{ue!==(ue=e(Z))&&(Q.value=(Q.__value=e(Z))??""),u($e,e(Z))}),l(C,Q)}),a(F),a(le),a(X);var N=r(X,2),j=t(N),oe=r(j,2);a(N),a(Ce),a(fe),a(B),Xe(h,()=>e($).evaluation_month,C=>ge($,e($).evaluation_month=C)),Xe(F,()=>e($).evaluation_year,C=>ge($,e($).evaluation_year=C)),Ie("click",j,()=>i(Ze,!1)),Ie("click",oe,Ba),l(v,B)};p(z,v=>{e(Ze)&&v(Ae)})}var Ee=r(z,2);{var ie=v=>{mr(v,{get show(){return e(We)},get user(){return e(f)},$$events:{close:()=>i(We,!1),success:se}})};p(Ee,v=>{e(We)&&v(ie)})}a(ke),l(ce,ke)};p(s,ce=>{e(f)?ce(E,!1):ce(_)},c)}};p(Pa,s=>{e(U)?s(ma):s(ga,!1)})}l(Ma,ka),rt(),ta()}export{Jr as component};
