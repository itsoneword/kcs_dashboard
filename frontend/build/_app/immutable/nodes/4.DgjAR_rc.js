import{f as g,a as v,c as Ut,t as Aa}from"../chunks/z1_h_S-m.js";import{i as je}from"../chunks/CKvl8f00.js";import{E as $e,G as Lt,p as Ne,h as Et,l as Ra,s as d,m as f,j as Pa,k as Ye,c as s,b as o,g as a,r as t,a as Ge,t as U,f as pa,o as Bt,e as ua,$ as At,n as da,i as Pt}from"../chunks/DO95TrpH.js";import{e as _,s as m,h as Rt}from"../chunks/DePN81sB.js";import{i as y}from"../chunks/i89i58Dp.js";import{e as Ca,i as Wa}from"../chunks/KzdxLMOR.js";import{r as Da,s as St}from"../chunks/B0rVqcg2.js";import{s as Xa}from"../chunks/DPUg7jpB.js";import{b as Ua}from"../chunks/CoGRtSRs.js";import{b as Ft}from"../chunks/DWPWRXnJ.js";import{g as ae}from"../chunks/BvPgAsJ_.js";import{a as Te,b as $}from"../chunks/VlzhU-cE.js";import{t as w}from"../chunks/BCl9OAM7.js";import{p as ze}from"../chunks/BytzElXY.js";function Tt(W,H,F){$e(()=>{var k=Lt(()=>H(W,F==null?void 0:F())||{});if(k!=null&&k.destroy)return()=>k.destroy()})}function ee(W){const H=F=>{W&&!W.contains(F.target)&&!F.defaultPrevented&&W.dispatchEvent(new CustomEvent("outclick"))};return document.addEventListener("click",H,!0),{destroy(){document.removeEventListener("click",H,!0)}}}var zt=g('<button class="text-gray-700 block w-full text-left px-4 py-2 text-sm hover:bg-gray-100" role="menuitem">Stop Being Manager For</button>'),jt=g('<button class="text-gray-700 block w-full text-left px-4 py-2 text-sm hover:bg-gray-100" role="menuitem">Become Manager For</button>'),$t=g('<button class="text-gray-700 block w-full text-left px-4 py-2 text-sm hover:bg-gray-100" role="menuitem">Assign Manager</button> <!>',1),Nt=g('<button class="text-gray-700 block w-full text-left px-4 py-2 text-sm hover:bg-gray-100" role="menuitem"> </button> <button class="text-gray-700 block w-full text-left px-4 py-2 text-sm hover:bg-gray-100" role="menuitem"> </button>',1),Yt=g('<button class="text-red-600 block w-full text-left px-4 py-2 text-sm hover:bg-gray-100" role="menuitem">Delete User</button>'),Gt=g('<hr class="my-1 border-gray-200"/> <button class="text-gray-700 block w-full text-left px-4 py-2 text-sm hover:bg-gray-100" role="menuitem">Change Password</button> <!> <!>',1),Kt=g('<div class="origin-top-right absolute right-0 mt-2 w-56 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 z-10" role="menu" aria-orientation="vertical" aria-labelledby="menu-button"><div class="py-1" role="none"><button class="text-gray-700 block w-full text-left px-4 py-2 text-sm hover:bg-gray-100" role="menuitem"> </button> <button class="text-gray-700 block w-full text-left px-4 py-2 text-sm hover:bg-gray-100" role="menuitem"> </button> <!> <!></div></div>'),qt=g('<div class="relative inline-block text-left overflow-visible"><button class="p-1 rounded-full text-gray-500 hover:bg-gray-100 focus:outline-none" aria-label="User actions"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"></path></svg></button> <!></div>');function Qt(W,H){Ne(H,!1);const F=f(),k=f(),L=f();let N=ze(H,"user",8),Y=ze(H,"currentUser",8);const P=Et();let X=f(!1);function u(){d(X,!a(X))}function R(){d(X,!1)}Ra(()=>Pa(Y()),()=>{var x;d(F,((x=Y())==null?void 0:x.is_admin)||!1)}),Ra(()=>Pa(Y()),()=>{var x;d(k,((x=Y())==null?void 0:x.is_manager)||!1)}),Ra(()=>(Pa(N()),Pa(Y())),()=>{var x;d(L,N().id===((x=Y())==null?void 0:x.id))}),Ye(),je();var T=qt(),ba=s(T),la=o(ba,2);{var fa=x=>{var I=Kt(),aa=s(I),ra=s(aa),S=s(ra,!0);t(ra);var sa=o(ra,2),va=s(sa,!0);t(sa);var ea=o(sa,2);{var ia=z=>{var J=$t(),oa=pa(J),xa=o(oa,2);{var ha=ca=>{var ya=Ut(),q=pa(ya);{var ta=O=>{var Q=zt();_("click",Q,()=>{P("stopBeingManager"),R()}),v(O,Q)},na=O=>{var Q=jt();_("click",Q,()=>{P("becomeManager"),R()}),v(O,Q)};y(q,O=>{N().managed_by_current_user?O(ta):O(na,!1)})}v(ca,ya)};y(xa,ca=>{(a(k)||a(F))&&ca(ha)})}_("click",oa,()=>{P("assignManager"),R()}),v(z,J)};y(ea,z=>{N().is_lead&&z(ia)})}var _a=o(ea,2);{var Sa=z=>{var J=Gt(),oa=o(pa(J),2),xa=o(oa,2);{var ha=q=>{var ta=Nt(),na=pa(ta),O=s(na,!0);t(na);var Q=o(na,2),Fa=s(Q,!0);t(Q),U(()=>{m(O,N().is_admin?"Remove Admin Role":"Assign Admin Role"),m(Fa,N().is_manager?"Remove Manager Role":"Assign Manager Role")}),_("click",na,()=>{P("makeAdmin"),R()}),_("click",Q,()=>{P("makeManager"),R()}),v(q,ta)};y(xa,q=>{a(L)||q(ha)})}var ca=o(xa,2);{var ya=q=>{var ta=Yt();_("click",ta,()=>{P("deleteUser"),R()}),v(q,ta)};y(ca,q=>{a(L)||q(ya)})}_("click",oa,()=>{P("changePassword"),R()}),v(z,J)};y(_a,z=>{a(F)&&z(Sa)})}t(aa),t(I),U(()=>{m(S,N().is_coach?"Remove Coach Role":"Assign Coach Role"),m(va,N().is_lead?"Remove Lead Role":"Assign Lead Role")}),_("click",ra,()=>{P("makeCoach"),R()}),_("click",sa,()=>{P("makeLead"),R()}),v(x,I)};y(la,x=>{a(X)&&x(fa)})}t(T),Tt(T,x=>ee==null?void 0:ee(x)),$e(()=>_("outclick",T,R)),_("click",ba,u),v(W,T),Ge()}var Zt=g("<span> </span>"),Ht=g('<div class="mb-4 bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded"> </div>'),It=g('<div class="mb-4 bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded"> </div>'),Jt=g('<div class="flex items-center justify-center py-12"><div class="text-center"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600 mx-auto"></div> <p class="mt-2 text-gray-600">Loading users...</p></div></div>'),Ot=g("<span> </span>"),Vt=g('<span class="text-gray-400">N/A</span>'),Wt=g('<tr><td class="px-6 py-4 whitespace-nowrap"><div><div class="text-sm font-medium text-gray-900"> </div> <div class="text-sm text-gray-500"> </div></div></td><td class="px-6 py-4 whitespace-nowrap"><div class="flex space-x-1"></div></td><td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"><!></td><td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"> </td><td class="px-6 py-4 whitespace-nowrap text-sm font-medium"><!></td></tr>'),Xt=g('<div class="card overflow-visible mb-8 min-h-[600px]"><div class="overflow-visible"><table class="min-w-full divide-y divide-gray-200"><thead class="bg-gray-50"><tr><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">User</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Roles</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Manager</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Created</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th></tr></thead><tbody class="bg-white divide-y divide-gray-200"></tbody></table></div></div> <div class="mt-6 grid grid-cols-1 md:grid-cols-4 gap-4 mb-8"><div class="card p-4"><div class="text-2xl font-bold text-gray-900"> </div> <div class="text-sm text-gray-500">Total Users</div></div> <div class="card p-4"><div class="text-2xl font-bold text-purple-600"> </div> <div class="text-sm text-gray-500">Admins</div></div> <div class="card p-4"><div class="text-2xl font-bold text-blue-600"> </div> <div class="text-sm text-gray-500">Leads</div></div> <div class="card p-4"><div class="text-2xl font-bold text-green-600"> </div> <div class="text-sm text-gray-500">Coaches</div></div></div>',1),ar=g('<span class="animate-spin inline-block w-4 h-4 border-2 border-current border-t-transparent rounded-full" role="status" aria-label="loading"></span> Refreshing...',1),er=g('<dl class="grid grid-cols-2 gap-x-4 gap-y-2 text-sm"><dt class="font-medium text-gray-500">Status:</dt> <dd class="text-gray-900"><span> </span></dd> <dt class="font-medium text-gray-500">Path:</dt> <dd class="text-gray-900 truncate"> </dd> <dt class="font-medium text-gray-500">Size:</dt> <dd class="text-gray-900"> </dd> <dt class="font-medium text-gray-500">Last Modified:</dt> <dd class="text-gray-900"> </dd></dl>'),tr=g('<p class="text-gray-500">Loading status...</p>'),rr=g('<p class="text-red-500"> </p>'),sr=g('<span class="animate-spin inline-block w-4 h-4 border-2 border-current border-t-transparent rounded-full" role="status" aria-label="loading"></span> Refreshing...',1),ir=g('<p class="text-gray-500">Loading backups...</p>'),or=g('<li class="py-3"><div class="flex justify-between items-center text-sm"><div><p class="font-medium text-gray-900"> </p> <p class="text-gray-500 text-xs"> </p></div> <span class="text-gray-700"> </span></div></li>'),nr=g('<ul class="divide-y divide-gray-200 max-h-120 overflow-y-auto"></ul>'),dr=g(`<p class="text-gray-500">No backups found. (Ensure 'backups' directory exists in
                    backend root).</p>`),lr=g('<span class="animate-spin inline-block w-4 h-4 border-2 border-current border-t-transparent rounded-full" role="status" aria-label="loading"></span> Changing...',1),vr=g('<div class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50"><div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white"><div class="mt-3"><h3 class="text-lg font-medium text-red-900 mb-4"> </h3> <div class="mb-4"><p class="text-sm text-gray-700 mb-4"> </p> <p class="text-sm font-medium text-gray-900 mb-2">Type <span class="font-bold text-red-600">DELETE</span> to confirm:</p> <input type="text" placeholder="Type DELETE to confirm" class="input"/></div> <div class="flex justify-end space-x-3"><button type="button" class="btn-secondary">Cancel</button> <button class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 disabled:opacity-50">Delete User</button></div></div></div></div>'),cr=g("<option> </option>"),mr=g('<div class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50"><div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white"><div class="mt-3"><h3 class="text-lg font-medium text-gray-900 mb-4"> </h3> <div class="mb-4"><p class="text-sm text-gray-700 mb-4">Select a manager to assign to this lead.</p> <div class="mb-4"><label for="managerSelect" class="block text-sm font-medium text-gray-700 mb-1">Select Manager</label> <select id="managerSelect" class="input w-full"><option>-- Select a Manager --</option><!></select></div></div> <div class="flex justify-end space-x-3"><button type="button" class="btn-secondary">Cancel</button> <button class="btn-primary">Assign Manager</button></div></div></div></div>'),gr=g('Current manager: <span class="font-medium"> </span>',1),ur=g(`<div class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50"><div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white"><div class="mt-3"><h3 class="text-lg font-medium text-red-900 mb-4"> </h3> <div class="mb-4"><p class="text-sm text-gray-700 mb-4">Are you sure you want to remove the manager assignment for this
            user? <!></p></div> <div class="flex justify-end space-x-3"><button type="button" class="btn-secondary">Cancel</button> <button class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700">Remove Manager</button></div></div></div></div>`),pr=g('<div class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50"><div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white"><div class="mt-3"><h3 class="text-lg font-medium text-gray-900 mb-4"> </h3> <div class="mb-4"><label class="block text-sm font-medium text-gray-700 mb-1">New Password</label> <input type="password" class="input w-full"/></div> <div class="mb-4"><label class="block text-sm font-medium text-gray-700 mb-1">Confirm Password</label> <input type="password" class="input w-full"/></div> <div class="flex justify-end space-x-3"><button type="button" class="btn-secondary">Cancel</button> <button type="button" class="btn-primary">Change Password</button></div></div></div></div>'),br=g(`<div class="min-h-screen bg-gray-50"><nav class="bg-white shadow-sm border-b border-gray-200"><div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"><div class="flex justify-between h-16"><div class="flex items-center space-x-4"><a href="/dashboard" class="text-primary-600 hover:text-primary-500"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg></a> <h1 class="text-xl font-semibold text-gray-900">User Management</h1></div> <div class="flex items-center space-x-4"><span class="text-sm text-gray-700"> </span> <!> <button class="btn-secondary text-sm">Logout</button></div></div></div></nav> <div class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8"><div class="px-4 py-6 sm:px-0"><div class="mb-6"><h2 class="text-2xl font-bold text-gray-900">User Management</h2> <p class="text-gray-600">Manage user roles and permissions</p></div> <div class="card mb-6"><div class="px-6 py-4"><div class="flex justify-between items-center"><div class="flex-1 max-w-md"><label class="block text-sm font-medium text-gray-700 mb-1">Search Users</label> <input type="text" placeholder="Search by name or email..." class="input"/></div> <span class="text-sm text-gray-500"> </span></div></div></div> <!> <!> <!> <div class="mt-12 pt-8 border-t border-gray-200"><div class="mb-6"><h2 class="text-2xl font-bold text-gray-900">Database Management</h2> <p class="text-gray-600">Manage database status and backups. Change active database file.</p></div> <div class="grid grid-cols-1 lg:grid-cols-2 gap-8"><div class="space-y-6"><div class="card"><div class="card-header"><h3 class="card-title">Database Status</h3> <button class="btn-secondary btn-sm"><!></button></div> <div class="card-body"><!></div></div> <div class="card"><div class="card-header"><h3 class="card-title">Database Backups</h3> <div class="space-x-2"><button class="btn-secondary btn-sm"><!></button> <button class="btn-primary btn-sm">Create Backup</button></div></div> <div class="card-body"><!></div></div></div> <div class="space-y-6"><div class="card"><div class="card-header"><h3 class="card-title">Change Active Database</h3></div> <div class="card-body"><p class="text-sm text-gray-600 mb-3">Enter the path to a new SQLite database file. The path can be
                  absolute or relative to the backend server root. The
                  application will attempt to connect to this new database.</p> <div class="mb-3"><label for="newDbPath" class="block text-sm font-medium text-gray-700 mb-1">New Database Path (.db)</label> <input type="text" id="newDbPath" class="input" placeholder="e.g., /path/to/your/new_database.db or ../data/another.db"/></div> <button class="btn-primary w-full"><!></button> <p class="text-xs text-gray-500 mt-2">Changing the database will restart the connection. Ensure the
                  path is correct and the file exists and is accessible by the
                  server.</p></div></div></div></div></div></div></div></div> <!> <!> <!> <!>`,1);function Ar(W,H){Ne(H,!1);const F=f();let k=f(null),L=f([]),N=f(!0),Y=f(""),P=f(""),X=f(!1),u=f(null),R=f(!1),T=f(null),ba=f(!1),la=f(""),fa=f(!1),x=f(""),I=f(""),aa=f(""),ra=[],S=f(null),sa=f([]),va=f(!1),ea=f(!1),ia=f(""),_a=f(!1);Bt(()=>{const e=Te.subscribe(async r=>{var i,l;if(!r.isAuthenticated&&!r.isLoading)ae("/login");else if(r.isAuthenticated){if(d(k,r.user),!((i=a(k))!=null&&i.is_admin)&&!((l=a(k))!=null&&l.is_manager)){ae("/dashboard");return}await z(),await te(),await Ta()}});return()=>e()});async function Sa(){await Te.logout(),ae("/login")}async function z(){var e,r;try{d(N,!0);const[i,l]=await Promise.all([$.getAllUsers(),$.getAllManagerAssignments()]);d(L,i.users),ra=l.assignments,d(L,a(L).map(n=>{const c=ra.find(p=>(p.user_id===n.id||p.assigned_to===n.id)&&!p.deleted_at);return c?{...n,has_manager:!0,manager_id:c.manager_id,manager_name:c.manager_name}:n})),a(L).forEach(n=>{a(k)&&n.manager_id===a(k).id&&(n.managed_by_current_user=!0)})}catch(i){d(Y,((r=(e=i.response)==null?void 0:e.data)==null?void 0:r.error)||"Failed to load users")}finally{d(N,!1)}}async function J(e,r){var i,l;try{d(Y,""),d(P,"");const n=await $.updateUserRoles(e,r);d(L,a(L).map(c=>c.id===e?n.user:c)),d(P,n.message),setTimeout(()=>{d(P,"")},3e3)}catch(n){d(Y,((l=(i=n.response)==null?void 0:i.data)==null?void 0:l.error)||"Failed to update user roles")}}function oa(e){if(!e)return["User"];const r=[];return e.is_admin&&r.push("Admin"),e.is_manager&&r.push("Manager"),e.is_lead&&r.push("Lead"),e.is_coach&&r.push("Coach"),r.length>0?r:["User"]}function xa(e){return new Date(e).toLocaleDateString()}function ha(e){d(u,e),d(la,""),d(X,!0)}async function ca(){var e,r;try{if(a(la)!=="DELETE"){w.add({type:"warning",message:'Please type "DELETE" to confirm'});return}if(!a(u))return;await $.deleteUser(a(u).id),d(X,!1),w.add({type:"success",message:"User deleted successfully"}),await z()}catch(i){console.error("Error deleting user:",i);const l=((r=(e=i.response)==null?void 0:e.data)==null?void 0:r.error)||"Failed to delete user";w.add({type:"error",message:l})}}function ya(e){d(u,e),d(R,!0)}async function q(){var e,r;if(a(u))try{const i=ra.find(l=>{var n;return l.assigned_to===((n=a(u))==null?void 0:n.id)&&!l.deleted_at});if(!i){w.add({type:"error",message:"No manager assignment found"});return}await $.removeManagerFromUser(i.manager_id,a(u).id),w.add({type:"success",message:`Removed manager from ${a(u).name}`}),d(ba,!1),await z()}catch(i){console.error("Error removing manager:",i);const l=((r=(e=i.response)==null?void 0:e.data)==null?void 0:r.error)||"Failed to remove manager";w.add({type:"error",message:l})}}async function ta(){var e,r;if(!(!a(u)||!a(T)))try{await $.assignManagerToUser(a(T).id,a(u).id),w.add({type:"success",message:`Assigned ${a(T).name} as manager to ${a(u).name}`}),d(R,!1),d(T,null),await z()}catch(i){console.error("Error assigning manager:",i);const l=((r=(e=i.response)==null?void 0:e.data)==null?void 0:r.error)||"Failed to assign manager";w.add({type:"error",message:l})}}async function na(e){var r,i;if(a(k))try{await $.assignManagerToUser(a(k).id,e.id),w.add({type:"success",message:`You are now the manager for ${e.name}`}),await z()}catch(l){console.error("Error becoming manager:",l);const n=((i=(r=l.response)==null?void 0:r.data)==null?void 0:i.error)||"Failed to become manager";w.add({type:"error",message:n})}}async function O(e){var r,i;if(a(k))try{await $.removeManagerFromUser(a(k).id,e.id),w.add({type:"success",message:`You are no longer the manager for ${e.name}`}),await z()}catch(l){console.error("Error removing manager assignment:",l),w.add({type:"error",message:((i=(r=l.response)==null?void 0:r.data)==null?void 0:i.error)||"Failed to remove manager assignment"})}}function Q(e){d(u,e),d(x,""),d(I,""),d(fa,!0)}async function Fa(){var e,r;if(a(u)){if(a(x)!==a(I)){w.add({type:"error",message:"Passwords do not match"});return}try{await $.changeUserPassword(a(u).id,a(x)),w.add({type:"success",message:"Password changed successfully"}),d(fa,!1),d(x,""),d(I,"")}catch(i){console.error("Error changing password:",i);const l=((r=(e=i.response)==null?void 0:e.data)==null?void 0:r.error)||"Failed to change password";w.add({type:"error",message:l})}}}async function te(){var e,r,i,l;d(va,!0);try{d(S,await $.getDatabaseStatus())}catch(n){w.add({type:"error",message:((r=(e=n.response)==null?void 0:e.data)==null?void 0:r.error)||"Failed to load DB status"}),d(S,{error:((l=(i=n.response)==null?void 0:i.data)==null?void 0:l.error)||"Failed to load DB status"})}finally{d(va,!1)}}async function Ke(){var e,r;try{const i=await $.createDatabaseBackup();w.add({type:"success",message:i.message}),await Ta()}catch(i){w.add({type:"error",message:((r=(e=i.response)==null?void 0:e.data)==null?void 0:r.error)||"Failed to create DB backup"})}}async function Ta(){var e,r;d(ea,!0);try{const i=await $.getDatabaseBackups();d(sa,i.backups)}catch(i){w.add({type:"error",message:((r=(e=i.response)==null?void 0:e.data)==null?void 0:r.error)||"Failed to load DB backups"})}finally{d(ea,!1)}}async function qe(){var e,r;if(!a(ia).trim()){w.add({type:"warning",message:"New database path cannot be empty."});return}d(_a,!0);try{const i=await $.changeDatabasePath(a(ia));w.add({type:"success",message:i.message}),d(S,{status:i.status,path:i.newPath,size:i.size,lastModified:i.lastModified,timestamp:i.timestamp}),d(ia,"")}catch(i){w.add({type:"error",message:((r=(e=i.response)==null?void 0:e.data)==null?void 0:r.error)||"Failed to change database path"})}finally{d(_a,!1)}}function re(e,r=2){if(e===0)return"0 Bytes";const i=1024,l=r<0?0:r,n=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],c=Math.floor(Math.log(e)/Math.log(i));return parseFloat((e/Math.pow(i,c)).toFixed(l))+" "+n[c]}Ra(()=>(a(L),a(aa)),()=>{d(F,a(L).filter(e=>!a(aa)||e.name.toLowerCase().includes(a(aa).toLowerCase())||e.email.toLowerCase().includes(a(aa).toLowerCase())))}),Ye(),je();var se=br();Rt(e=>{At.title="User Management - KCS Portal"});var za=pa(se),ja=s(za),ie=s(ja),oe=s(ie),ne=o(s(oe),2),$a=s(ne),Qe=s($a,!0);t($a);var de=o($a,2);Ca(de,1,()=>oa(a(k)),Wa,(e,r)=>{var i=Zt(),l=s(i,!0);t(i),U(n=>{Xa(i,1,`badge badge-${n??""}`),m(l,a(r))},[()=>a(r).toLowerCase()],ua),v(e,i)});var Ze=o(de,2);t(ne),t(oe),t(ie),t(ja);var le=o(ja,2),ve=s(le),Na=o(s(ve),2),ce=s(Na),me=s(ce),Ya=s(me),ge=o(s(Ya),2);Da(ge),t(Ya);var ue=o(Ya,2),He=s(ue);t(ue),t(me),t(ce),t(Na);var pe=o(Na,2);{var Ie=e=>{var r=Ht(),i=s(r,!0);t(r),U(()=>m(i,a(Y))),v(e,r)};y(pe,e=>{a(Y)&&e(Ie)})}var be=o(pe,2);{var Je=e=>{var r=It(),i=s(r,!0);t(r),U(()=>m(i,a(P))),v(e,r)};y(be,e=>{a(P)&&e(Je)})}var fe=o(be,2);{var Oe=e=>{var r=Jt();v(e,r)},Ve=e=>{var r=Xt(),i=pa(r),l=s(i),n=s(l),c=o(s(n));Ca(c,5,()=>a(F),Z=>Z.id,(Z,h)=>{var Ma=Wt(),Ha=s(Ma),Pe=s(Ha),Ia=s(Pe),_t=s(Ia,!0);t(Ia);var Re=o(Ia,2),xt=s(Re,!0);t(Re),t(Pe),t(Ha);var Ja=o(Ha),Se=s(Ja);Ca(Se,5,()=>oa(a(h)),Wa,(V,ga)=>{var Ba=Ot(),Ct=s(Ba,!0);t(Ba),U(Dt=>{Xa(Ba,1,`badge badge-${Dt??""}`),m(Ct,a(ga))},[()=>a(ga).toLowerCase()],ua),v(V,Ba)}),t(Se),t(Ja);var Oa=o(Ja),yt=s(Oa);{var ht=V=>{var ga=Aa();U(()=>m(ga,a(h).manager_name)),v(V,ga)},wt=V=>{var ga=Vt();v(V,ga)};y(yt,V=>{a(h).manager_name?V(ht):V(wt,!1)})}t(Oa);var Va=o(Oa),kt=s(Va,!0);t(Va);var Fe=o(Va),Mt=s(Fe);Qt(Mt,{get user(){return a(h)},get currentUser(){return a(k)},$$events:{makeCoach:()=>J(a(h).id,{is_coach:!a(h).is_coach}),makeLead:()=>J(a(h).id,{is_lead:!a(h).is_lead}),makeAdmin:()=>J(a(h).id,{is_admin:!a(h).is_admin}),makeManager:()=>J(a(h).id,{is_manager:!a(h).is_manager}),deleteUser:()=>ha(a(h)),assignManager:()=>ya(a(h)),becomeManager:()=>na(a(h)),stopBeingManager:()=>O(a(h)),changePassword:()=>Q(a(h))}}),t(Fe),t(Ma),U(V=>{m(_t,a(h).name),m(xt,a(h).email),m(kt,V)},[()=>xa(a(h).created_at)],ua),v(Z,Ma)}),t(c),t(n),t(l),t(i);var p=o(i,2),b=s(p),M=s(b),E=s(M,!0);t(M),da(2),t(b);var C=o(b,2),D=s(C),A=s(D,!0);t(D),da(2),t(C);var B=o(C,2),j=s(B),G=s(j,!0);t(j),da(2),t(B);var K=o(B,2),ma=s(K),ka=s(ma,!0);t(ma),da(2),t(K),t(p),U((Z,h,Ma)=>{m(E,a(L).length),m(A,Z),m(G,h),m(ka,Ma)},[()=>a(L).filter(Z=>Z.is_admin).length,()=>a(L).filter(Z=>Z.is_lead).length,()=>a(L).filter(Z=>Z.is_coach).length],ua),v(e,r)};y(fe,e=>{a(N)?e(Oe):e(Ve,!1)})}var _e=o(fe,2),xe=o(s(_e),2),Ga=s(xe),Ka=s(Ga),qa=s(Ka),La=o(s(qa),2),We=s(La);{var Xe=e=>{var r=ar();da(),v(e,r)},at=e=>{var r=Aa("Refresh");v(e,r)};y(We,e=>{a(va)?e(Xe):e(at,!1)})}t(La),t(qa);var ye=o(qa,2),et=s(ye);{var tt=e=>{var r=er(),i=o(s(r),2),l=s(i),n=s(l,!0);t(l),t(i);var c=o(i,4),p=s(c,!0);t(c);var b=o(c,4),M=s(b,!0);t(b);var E=o(b,4),C=s(E,!0);t(E),t(r),U((D,A)=>{Xa(l,1,`badge ${a(S).status==="healthy"?"badge-success":"badge-danger"}`),m(n,a(S).status),St(c,"title",a(S).path),m(p,a(S).path),m(M,D),m(C,A)},[()=>re(a(S).size),()=>a(S).lastModified?new Date(a(S).lastModified).toLocaleString():"N/A"],ua),v(e,r)},rt=(e,r)=>{{var i=n=>{var c=tr();v(n,c)},l=n=>{var c=rr(),p=s(c);t(c),U(()=>{var b;return m(p,`Error: ${((b=a(S))==null?void 0:b.error)||"Could not load database status."}`)}),v(n,c)};y(e,n=>{a(va)?n(i):n(l,!1)},r)}};y(et,e=>{a(S)&&!a(S).error?e(tt):e(rt,!1)})}t(ye),t(Ka);var he=o(Ka,2),Qa=s(he),we=o(s(Qa),2),wa=s(we),st=s(wa);{var it=e=>{var r=sr();da(),v(e,r)},ot=e=>{var r=Aa("Refresh");v(e,r)};y(st,e=>{a(ea)?e(it):e(ot,!1)})}t(wa);var ke=o(wa,2);t(we),t(Qa);var Me=o(Qa,2),nt=s(Me);{var dt=e=>{var r=ir();v(e,r)},lt=(e,r)=>{{var i=n=>{var c=nr();Ca(c,5,()=>a(sa),p=>p.filename,(p,b)=>{var M=or(),E=s(M),C=s(E),D=s(C),A=s(D,!0);t(D);var B=o(D,2),j=s(B);t(B),t(C);var G=o(C,2),K=s(G,!0);t(G),t(E),t(M),U((ma,ka)=>{m(A,a(b).filename),m(j,`Created: ${ma??""}`),m(K,ka)},[()=>new Date(a(b).created).toLocaleString(),()=>re(a(b).size)],ua),v(p,M)}),t(c),v(n,c)},l=n=>{var c=dr();v(n,c)};y(e,n=>{a(sa).length>0?n(i):n(l,!1)},r)}};y(nt,e=>{a(ea)?e(dt):e(lt,!1)})}t(Me),t(he),t(Ga);var Ce=o(Ga,2),De=s(Ce),Ue=o(s(De),2),Za=o(s(Ue),2),Le=o(s(Za),2);Da(Le),t(Za);var Ea=o(Za,2),vt=s(Ea);{var ct=e=>{var r=lr();da(),v(e,r)},mt=e=>{var r=Aa("Change Database");v(e,r)};y(vt,e=>{a(_a)?e(ct):e(mt,!1)})}t(Ea),da(2),t(Ue),t(De),t(Ce),t(xe),t(_e),t(ve),t(le),t(za);var Ee=o(za,2);{var gt=e=>{var r=vr(),i=s(r),l=s(i),n=s(l),c=s(n);t(n);var p=o(n,2),b=s(p),M=s(b);t(b);var E=o(b,4);Da(E),t(p);var C=o(p,2),D=s(C),A=o(D,2);t(C),t(l),t(i),t(r),U(()=>{m(c,`Delete User: ${a(u).name??""}`),m(M,`This will permanently delete the user (${a(u).email??""}). The
            user will no longer be able to access the system and will be removed
            from all lists.`),A.disabled=a(la)!=="DELETE"}),Ua(E,()=>a(la),B=>d(la,B)),_("click",D,()=>d(X,!1)),_("click",A,ca),v(e,r)};y(Ee,e=>{a(X)&&a(u)&&e(gt)})}var Be=o(Ee,2);{var ut=e=>{var r=mr(),i=s(r),l=s(i),n=s(l),c=s(n);t(n);var p=o(n,2),b=o(s(p),2),M=o(s(b),2);U(()=>{a(T),Pt(()=>{a(L),a(u)})});var E=s(M);E.value=(E.__value=null)??"";var C=o(E);Ca(C,1,()=>a(L).filter(j=>j.is_manager&&a(u)&&j.id!==a(u).id),Wa,(j,G)=>{var K=cr(),ma={},ka=s(K);t(K),U(()=>{ma!==(ma=a(G))&&(K.value=(K.__value=a(G))??""),m(ka,`${a(G).name??""} (${a(G).email??""})`)}),v(j,K)}),t(M),t(b),t(p);var D=o(p,2),A=s(D),B=o(A,2);t(D),t(l),t(i),t(r),U(()=>{m(c,`Assign Manager to ${a(u).name??""}`),B.disabled=!a(T)}),Ft(M,()=>a(T),j=>d(T,j)),_("click",A,()=>d(R,!1)),_("click",B,ta),v(e,r)};y(Be,e=>{a(R)&&a(u)&&e(ut)})}var Ae=o(Be,2);{var pt=e=>{var r=ur(),i=s(r),l=s(i),n=s(l),c=s(n);t(n);var p=o(n,2),b=s(p),M=o(s(b));{var E=B=>{var j=gr(),G=o(pa(j)),K=s(G,!0);t(G),U(()=>m(K,a(u).manager_name)),v(B,j)};y(M,B=>{a(u).manager_name&&B(E)})}t(b),t(p);var C=o(p,2),D=s(C),A=o(D,2);t(C),t(l),t(i),t(r),U(()=>m(c,`Remove Manager from ${a(u).name??""}`)),_("click",D,()=>d(ba,!1)),_("click",A,q),v(e,r)};y(Ae,e=>{a(ba)&&a(u)&&e(pt)})}var bt=o(Ae,2);{var ft=e=>{var r=pr(),i=s(r),l=s(i),n=s(l),c=s(n);t(n);var p=o(n,2),b=o(s(p),2);Da(b),t(p);var M=o(p,2),E=o(s(M),2);Da(E),t(M);var C=o(M,2),D=s(C),A=o(D,2);t(C),t(l),t(i),t(r),U(()=>{m(c,`Change Password: ${a(u).name??""}`),A.disabled=!a(x)||a(x)!==a(I)}),Ua(b,()=>a(x),B=>d(x,B)),Ua(E,()=>a(I),B=>d(I,B)),_("click",D,()=>d(fa,!1)),_("click",A,Fa),v(e,r)};y(bt,e=>{a(fa)&&a(u)&&e(ft)})}U(e=>{var r;m(Qe,(r=a(k))==null?void 0:r.name),m(He,`${a(F).length??""} of ${a(L).length??""} users`),La.disabled=a(va),wa.disabled=a(ea),ke.disabled=a(ea),Ea.disabled=e},[()=>a(_a)||!a(ia).trim()],ua),_("click",Ze,Sa),Ua(ge,()=>a(aa),e=>d(aa,e)),_("click",La,te),_("click",wa,Ta),_("click",ke,Ke),Ua(Le,()=>a(ia),e=>d(ia,e)),_("click",Ea,qe),v(W,se),Ge()}export{Ar as component};
